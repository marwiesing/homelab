2025-03-26 09:19:17,878 p=2861 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:19:17,891 p=2861 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:19:18,391 p=2861 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.167200'
  end: '2025-03-26 09:19:18.367168'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:19:18.199968'
  stderr: |-
    E0326 09:19:18.358834    2901 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:18.360316    2901 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:18.361647    2901 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:18.362956    2901 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:18.364324    2901 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:19:18,392 p=2861 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:19:18,392 p=2861 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:19:48,357 p=3008 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:19:48,365 p=3008 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:19:48,754 p=3008 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.053885'
  end: '2025-03-26 09:19:48.727638'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:19:48.673753'
  stderr: |-
    E0326 09:19:48.718965    3046 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:48.720479    3046 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:48.721968    3046 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:48.723483    3046 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:19:48.724837    3046 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:19:48,756 p=3008 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:19:48,757 p=3008 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:21:20,259 p=3395 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:21:20,266 p=3395 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:21:20,619 p=3395 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.049924'
  end: '2025-03-26 09:21:20.594451'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:21:20.544527'
  stderr: |-
    E0326 09:21:20.586487    3426 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:21:20.588122    3426 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:21:20.589410    3426 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:21:20.590579    3426 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:21:20.591775    3426 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:21:20,620 p=3395 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:21:20,620 p=3395 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:22:13,472 p=3640 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:22:13,481 p=3640 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:22:13,855 p=3640 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.048963'
  end: '2025-03-26 09:22:13.832929'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:22:13.783966'
  stderr: |-
    E0326 09:22:13.825105    3664 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:13.826376    3664 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:13.827594    3664 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:13.828952    3664 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:13.830217    3664 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:22:13,856 p=3640 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:22:13,856 p=3640 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:22:19,842 p=3687 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:22:19,849 p=3687 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:22:20,273 p=3687 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.050915'
  end: '2025-03-26 09:22:20.248159'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:22:20.197244'
  stderr: |-
    E0326 09:22:20.240098    3718 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:20.241441    3718 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:20.242783    3718 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:20.244047    3718 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:22:20.245382    3718 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:22:20,274 p=3687 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:22:20,274 p=3687 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:23:18,447 p=3937 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:23:18,455 p=3937 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:23:18,839 p=3937 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.055206'
  end: '2025-03-26 09:23:18.814972'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:23:18.759766'
  stderr: |-
    E0326 09:23:18.806857    3961 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:23:18.808300    3961 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:23:18.809595    3961 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:23:18.810932    3961 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:23:18.812275    3961 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:23:18,840 p=3937 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:23:18,840 p=3937 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:29:14,112 p=5239 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:29:14,121 p=5239 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:29:14,509 p=5239 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.050353'
  end: '2025-03-26 09:29:14.488120'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:29:14.437767'
  stderr: |-
    E0326 09:29:14.479830    5271 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:29:14.481413    5271 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:29:14.482674    5271 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:29:14.483924    5271 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:29:14.485278    5271 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:29:14,510 p=5239 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:29:14,510 p=5239 u=marwiesing n=ansible | localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:30:09,012 p=5481 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:30:09,018 p=5481 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:30:09,913 p=5481 u=marwiesing n=ansible | ok: [localhost]
2025-03-26 09:30:09,926 p=5481 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:30:10,290 p=5481 u=marwiesing n=ansible | fatal: [localhost]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
    ]
  delta: '0:00:00.048970'
  end: '2025-03-26 09:30:10.268694'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:30:10.219724'
  stderr: |-
    E0326 09:30:10.260659    5599 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:30:10.262082    5599 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:30:10.263371    5599 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:30:10.264607    5599 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    E0326 09:30:10.265931    5599 memcache.go:265] "Unhandled Error" err="couldn't get current server API group list: Get \"http://localhost:8080/api?timeout=32s\": dial tcp 127.0.0.1:8080: connect: connection refused"
    The connection to the server localhost:8080 was refused - did you specify the right host or port?
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-26 09:30:10,291 p=5481 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:30:10,291 p=5481 u=marwiesing n=ansible | localhost                  : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 09:32:34,230 p=6131 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:32:34,238 p=6131 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:35,538 p=6131 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:32:35,558 p=6131 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:35,970 p=6131 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 09:32:35,976 p=6131 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:36,335 p=6131 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 09:32:36,346 p=6131 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:36,844 p=6131 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 09:32:36,851 p=6131 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:37,257 p=6131 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:32:37,266 p=6131 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:37,335 p=6131 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:32:37,345 p=6131 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-26 09:32:41,248 p=6131 u=marwiesing n=ansible | changed: [ubuntu-1] => (item=prometheus-grafana-6c59f78f66-2n2tm)
2025-03-26 09:32:41,258 p=6131 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-26 09:33:41,683 p=6131 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.069124'
  end: '2025-03-26 09:33:41.592358'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 09:32:41.523234'
  stderr: |-
    timed out waiting for the condition on pods/loki-promtail-h6vcr
    timed out waiting for the condition on pods/loki-promtail-lh44s
    timed out waiting for the condition on pods/prometheus-grafana-6c59f78f66-2pxg7
    timed out waiting for the condition on pods/prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr
    timed out waiting for the condition on pods/prometheus-kube-state-metrics-5bc7f89f46-r5tck
    timed out waiting for the condition on pods/prometheus-prometheus-kube-prometheus-prometheus-0
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-7hr7q
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-jxdls
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-qnlvw
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-sp42q
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
  stdout_lines: <omitted>
2025-03-26 09:33:41,684 p=6131 u=marwiesing n=ansible | ...ignoring
2025-03-26 09:33:41,689 p=6131 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:33:41,998 p=6131 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:33:42,003 p=6131 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-26 09:33:42,391 p=6131 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:33:42,398 p=6131 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-26 09:33:42,424 p=6131 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100 + 1 more...   7d14h
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS        AGE   IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   4 (6d1h ago)    10d   10.32.0.16      debian-1   <none>           <none>
    loki-0                                                   1/1     Running   2 (6d1h ago)    10d   10.32.0.14      debian-1   <none>           <none>
    loki-promtail-h6vcr                                      0/1     Unknown   5               10d   <none>          ubuntu     <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   2 (6d1h ago)    10d   10.32.0.10      debian-1   <none>           <none>
    prometheus-grafana-6c59f78f66-2pxg7                      3/3     Running   0               65s   10.32.0.20      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr     1/1     Running   2 (6d1h ago)    10d   10.32.0.3       debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-r5tck           1/1     Running   416 (41m ago)   10d   10.32.0.15      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   4 (6d1h ago)    10d   10.32.0.19      debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-7hr7q                1/1     Running   0               64s   192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-jxdls                1/1     Running   0               66s   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-qnlvw                1/1     Running   0               61s   192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-xv9xz                1/1     Running   0               60s   192.168.0.56    rocky-1    <none>           <none>
2025-03-26 09:33:42,464 p=6131 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:33:42,464 p=6131 u=marwiesing n=ansible | ubuntu-1                   : ok=11   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=1   
2025-03-26 09:38:22,006 p=7440 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-26 09:38:22,013 p=7440 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:38:23,887 p=7440 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:38:24,144 p=7440 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 09:38:24,285 p=7440 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-26 09:38:24,729 p=7440 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 09:38:24,771 p=7440 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-26 09:38:25,298 p=7440 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 09:38:25,362 p=7440 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:38:25,362 p=7440 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-26 09:38:25,397 p=7440 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 09:38:25,404 p=7440 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-26 09:38:25,850 p=7440 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-26 09:38:25,856 p=7440 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 09:38:25,877 p=7440 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 09:38:25,950 p=7440 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 09:38:25,965 p=7440 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-26 09:38:27,245 p=7440 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 09:38:27,422 p=7440 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-26 09:38:27,812 p=7440 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-26 09:38:28,245 p=7440 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 09:38:28,250 p=7440 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-26 09:38:28,982 p=7440 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 09:38:29,101 p=7440 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-26 09:38:29,824 p=7440 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 09:38:30,276 p=7440 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-26 09:38:30,447 p=7440 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-26 09:38:30,459 p=7440 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 09:38:31,564 p=7440 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:38:31,584 p=7440 u=marwiesing n=ansible | TASK [Pause for services to stabilize] ***********************************************************************************************************************************************************************************************************************
2025-03-26 09:38:31,624 p=7440 u=marwiesing n=ansible | Pausing for 5 seconds
2025-03-26 09:38:31,625 p=7440 u=marwiesing n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2025-03-26 09:38:36,631 p=7440 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:38:36,637 p=7440 u=marwiesing n=ansible | TASK [Check API server health endpoint] **********************************************************************************************************************************************************************************************************************
2025-03-26 09:38:37,245 p=7440 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 09:38:37,257 p=7440 u=marwiesing n=ansible | TASK [Display API health response] ***************************************************************************************************************************************************************************************************************************
2025-03-26 09:38:37,278 p=7440 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: 'Control plane API server health: ok'
2025-03-26 09:38:37,320 p=7440 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 09:38:37,322 p=7440 u=marwiesing n=ansible | debian-1                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 09:38:37,322 p=7440 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 09:38:37,322 p=7440 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 09:38:37,322 p=7440 u=marwiesing n=ansible | ubuntu-2                   : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:53:59,124 p=2362 u=marwiesing n=ansible | ERROR! the playbook: ask-become-pass could not be found
2025-03-26 13:54:19,304 p=2373 u=marwiesing n=ansible | ERROR! the playbook: ask-become-pass could not be found
2025-03-26 13:54:50,832 p=2379 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-26 13:54:50,843 p=2379 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:54:51,837 p=2379 u=marwiesing n=ansible | fatal: [ubuntu-2]: FAILED! => 
  msg: Missing sudo password
2025-03-26 13:54:51,849 p=2379 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => 
  msg: Missing sudo password
2025-03-26 13:54:52,619 p=2379 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 13:54:52,806 p=2379 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 13:54:52,825 p=2379 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-26 13:54:53,249 p=2379 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 13:54:53,321 p=2379 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 13:54:53,331 p=2379 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-26 13:54:53,600 p=2379 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 13:54:53,701 p=2379 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 13:54:53,706 p=2379 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-26 13:54:54,690 p=2379 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 13:54:54,757 p=2379 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-26 13:54:54,764 p=2379 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-26 13:54:55,311 p=2379 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-26 13:54:55,390 p=2379 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 13:54:55,445 p=2379 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-26 13:54:55,450 p=2379 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 13:54:55,450 p=2379 u=marwiesing n=ansible | debian-1                   : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:54:55,450 p=2379 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:54:55,450 p=2379 u=marwiesing n=ansible | ubuntu-1                   : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 13:54:55,450 p=2379 u=marwiesing n=ansible | ubuntu-2                   : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-26 13:55:30,366 p=2500 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-26 13:55:30,372 p=2500 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:55:31,795 p=2500 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 13:55:31,895 p=2500 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 13:55:31,928 p=2500 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:55:32,316 p=2500 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-26 13:55:32,367 p=2500 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-26 13:55:32,914 p=2500 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 13:55:32,935 p=2500 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-26 13:55:32,949 p=2500 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:55:32,990 p=2500 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 13:55:32,998 p=2500 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-26 13:55:33,403 p=2500 u=marwiesing n=ansible | ok: [debian-1]
2025-03-26 13:55:33,423 p=2500 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:55:33,476 p=2500 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-26 13:55:33,517 p=2500 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-26 13:55:33,527 p=2500 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-26 13:55:34,678 p=2500 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-26 13:55:35,170 p=2500 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:55:35,204 p=2500 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 13:55:35,223 p=2500 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-26 13:55:35,237 p=2500 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-26 13:55:35,986 p=2500 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-26 13:55:36,003 p=2500 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-26 13:55:36,012 p=2500 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:55:36,024 p=2500 u=marwiesing n=ansible | changed: [debian-1]
2025-03-26 13:55:36,264 p=2500 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-26 13:55:36,282 p=2500 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:55:37,764 p=2500 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:55:37,785 p=2500 u=marwiesing n=ansible | TASK [Pause for services to stabilize] ***********************************************************************************************************************************************************************************************************************
2025-03-26 13:55:37,799 p=2500 u=marwiesing n=ansible | Pausing for 5 seconds
2025-03-26 13:55:37,799 p=2500 u=marwiesing n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2025-03-26 13:55:42,802 p=2500 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:55:42,808 p=2500 u=marwiesing n=ansible | TASK [Check API server health endpoint] **********************************************************************************************************************************************************************************************************************
2025-03-26 13:55:43,506 p=2500 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:55:43,516 p=2500 u=marwiesing n=ansible | TASK [Display API health response] ***************************************************************************************************************************************************************************************************************************
2025-03-26 13:55:43,531 p=2500 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: 'Control plane API server health: ok'
2025-03-26 13:55:43,557 p=2500 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 13:55:43,558 p=2500 u=marwiesing n=ansible | debian-1                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:55:43,558 p=2500 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:55:43,558 p=2500 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:55:43,558 p=2500 u=marwiesing n=ansible | ubuntu-2                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-26 13:56:16,056 p=2687 u=marwiesing n=ansible | ERROR! 'ansible.builtin.debug' is not a valid attribute for a Play

The error appears to be in '/home/marwiesing/playground/ansible/00_Repair_Playbooks/02_patch_k8s_daemonset.yml': line 106, column 3, but may
be elsewhere in the file depending on the exact syntax problem.

The offending line appears to be:


- name: Final report summary
  ^ here

2025-03-26 13:56:47,637 p=2713 u=marwiesing n=ansible | ERROR! 'ansible.builtin.debug' is not a valid attribute for a Play

The error appears to be in '/home/marwiesing/playground/ansible/00_Repair_Playbooks/02_patch_k8s_daemonset.yml': line 2, column 3, but may
be elsewhere in the file depending on the exact syntax problem.

The offending line appears to be:

---
- name: Patch Kubernetes DaemonSet and Service
  ^ here

2025-03-26 13:58:03,809 p=3054 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 13:58:03,820 p=3054 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:05,445 p=3054 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:58:05,466 p=3054 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:06,007 p=3054 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:58:06,014 p=3054 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:06,376 p=3054 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:58:06,388 p=3054 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:06,912 p=3054 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:58:06,921 p=3054 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:07,361 p=3054 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:58:07,367 p=3054 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:07,437 p=3054 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:58:07,455 p=3054 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-26 13:58:08,006 p=3054 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:58:08,013 p=3054 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-26 13:58:08,027 p=3054 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-26 13:58:08,042 p=3054 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:10,090 p=3054 u=marwiesing n=ansible | changed: [ubuntu-1] => (item=prometheus-grafana-6c59f78f66-2pxg7)
2025-03-26 13:58:10,103 p=3054 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-26 13:58:10,657 p=3054 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:58:10,668 p=3054 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-26 13:58:11,144 p=3054 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  msg: 'There was an issue creating /var/lib/docker/containers as requested: [Errno 13] Permission denied: b''/var/lib/docker/containers'''
  path: /var/lib/docker/containers
2025-03-26 13:58:11,146 p=3054 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 13:58:11,146 p=3054 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=4    unreachable=0    failed=1    skipped=1    rescued=0    ignored=0   
2025-03-26 13:59:40,436 p=3472 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 13:59:40,442 p=3472 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:41,921 p=3472 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:59:41,937 p=3472 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:42,407 p=3472 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:59:42,419 p=3472 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:42,791 p=3472 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:59:42,801 p=3472 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:43,191 p=3472 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 13:59:43,197 p=3472 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:43,550 p=3472 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:59:43,559 p=3472 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:43,596 p=3472 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:59:43,612 p=3472 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-26 13:59:44,149 p=3472 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:59:44,156 p=3472 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-26 13:59:44,165 p=3472 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-26 13:59:44,174 p=3472 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:44,185 p=3472 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-26 13:59:44,195 p=3472 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-26 13:59:44,619 p=3472 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 13:59:44,628 p=3472 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-26 13:59:44,909 p=3472 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  msg: 'There was an issue creating /var/lib/docker/containers as requested: [Errno 13] Permission denied: b''/var/lib/docker/containers'''
  path: /var/lib/docker/containers
2025-03-26 13:59:44,912 p=3472 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 13:59:44,912 p=3472 u=marwiesing n=ansible | ubuntu-1                   : ok=8    changed=3    unreachable=0    failed=1    skipped=2    rescued=0    ignored=0   
2025-03-26 14:01:42,251 p=3980 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-26 14:01:42,258 p=3980 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:43,794 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:43,820 p=3980 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:44,244 p=3980 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 14:01:44,252 p=3980 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:44,613 p=3980 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 14:01:44,627 p=3980 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:45,047 p=3980 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 14:01:45,054 p=3980 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:45,454 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:45,463 p=3980 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:45,547 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:45,560 p=3980 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-26 14:01:45,965 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:45,972 p=3980 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-26 14:01:45,984 p=3980 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-26 14:01:45,992 p=3980 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:46,002 p=3980 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-26 14:01:46,009 p=3980 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-26 14:01:46,446 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:46,452 p=3980 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-26 14:01:46,748 p=3980 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 14:01:46,756 p=3980 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:47,095 p=3980 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-26 14:01:47,107 p=3980 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:48,832 p=3980 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=90s
  delta: '0:00:01.387715'
  end: '2025-03-26 14:01:48.816751'
  msg: non-zero return code
  rc: 1
  start: '2025-03-26 14:01:47.429036'
  stderr: |-
    Error from server (NotFound): pods "prometheus-prometheus-node-exporter-l57cz" not found
    Error from server (NotFound): pods "prometheus-prometheus-node-exporter-vlnsj" not found
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-wnmnt condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-r5tck condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
    pod/prometheus-prometheus-node-exporter-4h6ng condition met
    pod/prometheus-prometheus-node-exporter-s987q condition met
    pod/prometheus-prometheus-node-exporter-zqwr6 condition met
  stdout_lines: <omitted>
2025-03-26 14:01:48,832 p=3980 u=marwiesing n=ansible | ...ignoring
2025-03-26 14:01:48,839 p=3980 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:49,242 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:49,248 p=3980 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:49,585 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-26 14:01:49,593 p=3980 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:49,609 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100 + 1 more...   7d18h
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   6 (37m ago)     10d     10.32.0.16      debian-1   <none>           <none>
    loki-0                                                   1/1     Running   3 (37m ago)     10d     10.32.0.14      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   3 (37m ago)     10d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   1 (39m ago)     3h58m   10.44.0.4       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-wnmnt                      3/3     Running   0               3m41s   10.32.0.19      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr     1/1     Running   3 (37m ago)     10d     10.32.0.3       debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-r5tck           1/1     Running   434 (39m ago)   10d     10.32.0.15      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   6 (37m ago)     10d     10.32.0.18      debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4h6ng                1/1     Running   0               5s      192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4vlzb                1/1     Running   0               2s      192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-s987q                1/1     Running   0               4s      192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-zqwr6                1/1     Running   0               2s      192.168.0.56    rocky-1    <none>           <none>
2025-03-26 14:01:49,623 p=3980 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:49,653 p=3980 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100 + 1 more...   7d18h
     Current Pod overview:
      NAME                                                     READY   STATUS    RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   6 (37m ago)     10d     10.32.0.16      debian-1   <none>           <none>
    loki-0                                                   1/1     Running   3 (37m ago)     10d     10.32.0.14      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   3 (37m ago)     10d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   1 (39m ago)     3h58m   10.44.0.4       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-wnmnt                      3/3     Running   0               3m41s   10.32.0.19      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr     1/1     Running   3 (37m ago)     10d     10.32.0.3       debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-r5tck           1/1     Running   434 (39m ago)   10d     10.32.0.15      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   6 (37m ago)     10d     10.32.0.18      debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4h6ng                1/1     Running   0               5s      192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4vlzb                1/1     Running   0               2s      192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-s987q                1/1     Running   0               4s      192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-zqwr6                1/1     Running   0               2s      192.168.0.56    rocky-1    <none>           <none>
2025-03-26 14:01:49,689 p=3980 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-26 14:01:49,689 p=3980 u=marwiesing n=ansible | ubuntu-1                   : ok=15   changed=5    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 10:00:14,173 p=8652 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-28 10:00:14,181 p=8652 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:15,805 p=8652 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:00:15,813 p=8652 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:15,972 p=8652 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:00:16,063 p=8652 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:00:16,115 p=8652 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-28 10:00:16,617 p=8652 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:00:16,644 p=8652 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:16,685 p=8652 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:00:16,694 p=8652 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:00:16,704 p=8652 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-28 10:00:17,167 p=8652 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:00:17,203 p=8652 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:00:17,224 p=8652 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:00:17,290 p=8652 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:00:17,305 p=8652 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:18,635 p=8652 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:00:18,773 p=8652 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:00:18,975 p=8652 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:00:19,329 p=8652 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:00:19,335 p=8652 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:20,094 p=8652 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:00:20,114 p=8652 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:00:20,278 p=8652 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:00:20,328 p=8652 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:00:20,496 p=8652 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-28 10:00:20,503 p=8652 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:21,411 p=8652 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:21,430 p=8652 u=marwiesing n=ansible | TASK [Pause for services to stabilize] ***********************************************************************************************************************************************************************************************************************
2025-03-28 10:00:21,452 p=8652 u=marwiesing n=ansible | Pausing for 5 seconds
2025-03-28 10:00:21,455 p=8652 u=marwiesing n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2025-03-28 10:00:26,458 p=8652 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:26,467 p=8652 u=marwiesing n=ansible | TASK [Check API server health endpoint] **********************************************************************************************************************************************************************************************************************
2025-03-28 10:00:26,991 p=8652 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:26,998 p=8652 u=marwiesing n=ansible | TASK [Display API health response] ***************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:27,018 p=8652 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: 'Control plane API server health: ok'
2025-03-28 10:00:27,052 p=8652 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:27,052 p=8652 u=marwiesing n=ansible | debian-1                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:00:27,052 p=8652 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:00:27,052 p=8652 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:00:27,052 p=8652 u=marwiesing n=ansible | ubuntu-2                   : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:00:43,224 p=8959 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 10:00:43,234 p=8959 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:44,239 p=8959 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:44,255 p=8959 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:44,695 p=8959 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:00:44,703 p=8959 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:45,042 p=8959 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:00:45,050 p=8959 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:45,375 p=8959 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:00:45,384 p=8959 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:45,714 p=8959 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:45,720 p=8959 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 10:00:45,771 p=8959 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:45,783 p=8959 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 10:00:46,135 p=8959 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:00:46,144 p=8959 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 10:00:46,156 p=8959 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 10:00:46,166 p=8959 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 10:11:55,559 p=8959 u=marwiesing n=ansible |  [ERROR]: User interrupted execution

2025-03-28 10:13:16,638 p=11712 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 10:13:16,646 p=11712 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:17,902 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:13:17,916 p=11712 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:18,328 p=11712 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:13:18,334 p=11712 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:18,673 p=11712 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:13:18,679 p=11712 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:19,073 p=11712 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:13:19,082 p=11712 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:19,455 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:13:19,465 p=11712 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:19,505 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:13:19,518 p=11712 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 10:13:19,841 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:13:19,850 p=11712 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 10:13:19,862 p=11712 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 10:13:19,897 p=11712 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:19,917 p=11712 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 10:13:19,927 p=11712 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 10:13:20,319 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:13:20,325 p=11712 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 10:13:20,615 p=11712 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:13:20,623 p=11712 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 10:13:20,897 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:13:20,905 p=11712 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 10:14:21,226 p=11712 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.050207'
  end: '2025-03-28 10:14:21.272433'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 10:13:21.222226'
  stderr: |-
    timed out waiting for the condition on pods/alertmanager-prometheus-kube-prometheus-alertmanager-0
    timed out waiting for the condition on pods/loki-0
    timed out waiting for the condition on pods/loki-promtail-lh44s
    timed out waiting for the condition on pods/loki-promtail-qtk9h
    timed out waiting for the condition on pods/prometheus-grafana-6c59f78f66-bsm44
    timed out waiting for the condition on pods/prometheus-grafana-6c59f78f66-wnmnt
    timed out waiting for the condition on pods/prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr
    timed out waiting for the condition on pods/prometheus-kube-state-metrics-5bc7f89f46-r5tck
    timed out waiting for the condition on pods/prometheus-prometheus-kube-prometheus-prometheus-0
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-4h6ng
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-4vlzb
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-s987q
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-zqwr6
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 10:14:21,226 p=11712 u=marwiesing n=ansible | ...ignoring
2025-03-28 10:14:21,233 p=11712 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:14:21,573 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:14:21,580 p=11712 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 10:14:21,897 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:14:21,903 p=11712 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 10:14:21,921 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS   AGE
    prometheus-prometheus-node-exporter   <none>      9d
  - |-
    Pods:
    NAME                                                     READY   STATUS        RESTARTS        AGE   IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running       6 (44h ago)     12d   10.32.0.16      debian-1   <none>           <none>
    loki-0                                                   1/1     Running       3 (44h ago)     12d   10.32.0.14      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running       3 (44h ago)     12d   10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running       3 (83m ago)     2d    10.44.0.4       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-bsm44                      0/3     Pending       0               13m   <none>          debian-1   <none>           <none>
    prometheus-grafana-6c59f78f66-wnmnt                      2/3     Terminating   15 (18m ago)    44h   10.32.0.19      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr     1/1     Running       3 (44h ago)     12d   10.32.0.3       debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-r5tck           1/1     Running       475 (83m ago)   12d   10.32.0.15      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running       6 (44h ago)     12d   10.32.0.18      debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4h6ng                1/1     Terminating   0               44h   192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4vlzb                1/1     Terminating   2 (83m ago)     44h   192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-s987q                1/1     Terminating   2 (74m ago)     44h   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-zqwr6                1/1     Terminating   0               44h   192.168.0.56    rocky-1    <none>           <none>
2025-03-28 10:14:21,927 p=11712 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 10:14:21,943 p=11712 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS   AGE
    prometheus-prometheus-node-exporter   <none>      9d
     Current Pod overview:
      NAME                                                     READY   STATUS        RESTARTS        AGE   IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running       6 (44h ago)     12d   10.32.0.16      debian-1   <none>           <none>
    loki-0                                                   1/1     Running       3 (44h ago)     12d   10.32.0.14      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running       3 (44h ago)     12d   10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running       3 (83m ago)     2d    10.44.0.4       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-bsm44                      0/3     Pending       0               13m   <none>          debian-1   <none>           <none>
    prometheus-grafana-6c59f78f66-wnmnt                      2/3     Terminating   15 (18m ago)    44h   10.32.0.19      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-lj6zr     1/1     Running       3 (44h ago)     12d   10.32.0.3       debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-r5tck           1/1     Running       475 (83m ago)   12d   10.32.0.15      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running       6 (44h ago)     12d   10.32.0.18      debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4h6ng                1/1     Terminating   0               44h   192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4vlzb                1/1     Terminating   2 (83m ago)     44h   192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-s987q                1/1     Terminating   2 (74m ago)     44h   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-zqwr6                1/1     Terminating   0               44h   192.168.0.56    rocky-1    <none>           <none>
2025-03-28 10:14:21,964 p=11712 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 10:14:21,965 p=11712 u=marwiesing n=ansible | ubuntu-1                   : ok=15   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 10:15:19,368 p=12250 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-28 10:15:19,374 p=12250 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:15:20,975 p=12250 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:15:21,068 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:15:21,078 p=12250 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:15:21,205 p=12250 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:15:21,247 p=12250 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-28 10:15:21,848 p=12250 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:15:21,858 p=12250 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:15:21,892 p=12250 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:15:21,925 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:15:21,947 p=12250 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-28 10:15:22,401 p=12250 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:15:22,460 p=12250 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:15:22,472 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:15:22,542 p=12250 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:15:22,557 p=12250 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-28 10:15:23,849 p=12250 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:15:23,888 p=12250 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:15:23,921 p=12250 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:15:24,270 p=12250 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:15:24,277 p=12250 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-28 10:15:25,061 p=12250 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:15:25,088 p=12250 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:15:25,099 p=12250 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:15:25,115 p=12250 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:15:25,273 p=12250 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-28 10:15:25,285 p=12250 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:15:26,208 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:15:26,223 p=12250 u=marwiesing n=ansible | TASK [Pause for services to stabilize] ***********************************************************************************************************************************************************************************************************************
2025-03-28 10:15:26,234 p=12250 u=marwiesing n=ansible | Pausing for 5 seconds
2025-03-28 10:15:26,234 p=12250 u=marwiesing n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2025-03-28 10:15:31,238 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:15:31,244 p=12250 u=marwiesing n=ansible | TASK [Check API server health endpoint] **********************************************************************************************************************************************************************************************************************
2025-03-28 10:15:31,731 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:15:31,739 p=12250 u=marwiesing n=ansible | TASK [Display API health response] ***************************************************************************************************************************************************************************************************************************
2025-03-28 10:15:31,755 p=12250 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: 'Control plane API server health: ok'
2025-03-28 10:15:31,774 p=12250 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 10:15:31,774 p=12250 u=marwiesing n=ansible | debian-1                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:15:31,774 p=12250 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:15:31,774 p=12250 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:15:31,774 p=12250 u=marwiesing n=ansible | ubuntu-2                   : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:30:40,103 p=2702 u=marwiesing n=ansible | PLAY [Rolling reboot of Kubernetes worker nodes] ********************************************************************************************************
2025-03-28 10:30:40,117 p=2702 u=marwiesing n=ansible | TASK [Gathering Facts] **********************************************************************************************************************************
2025-03-28 10:30:41,734 p=2702 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:30:41,752 p=2702 u=marwiesing n=ansible | TASK [Capture current hostname] *************************************************************************************************************************
2025-03-28 10:30:42,100 p=2702 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:30:42,116 p=2702 u=marwiesing n=ansible | TASK [Notify reboot start] ******************************************************************************************************************************
2025-03-28 10:30:42,161 p=2702 u=marwiesing n=ansible | ok: [ubuntu-2] => 
  msg: "\U0001F504 Rebooting ubuntu-2 (ubuntu-2)..."
2025-03-28 10:30:42,170 p=2702 u=marwiesing n=ansible | TASK [Reboot the node] **********************************************************************************************************************************
2025-03-28 10:32:25,874 p=2702 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:32:25,897 p=2702 u=marwiesing n=ansible | TASK [Wait for node to be Ready in Kubernetes] **********************************************************************************************************
2025-03-28 10:32:25,958 p=2702 u=marwiesing n=ansible | fatal: [ubuntu-2 -> control_plane]: UNREACHABLE! => changed=false 
  msg: 'Failed to connect to the host via ssh: ssh: Could not resolve hostname control_plane: Name or service not known'
  unreachable: true
2025-03-28 10:32:25,959 p=2702 u=marwiesing n=ansible | NO MORE HOSTS LEFT **************************************************************************************************************************************
2025-03-28 10:32:25,960 p=2702 u=marwiesing n=ansible | PLAY [Rolling reboot of Kubernetes worker nodes] ********************************************************************************************************
2025-03-28 10:32:25,962 p=2702 u=marwiesing n=ansible | TASK [Gathering Facts] **********************************************************************************************************************************
2025-03-28 10:32:27,078 p=2702 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:32:27,088 p=2702 u=marwiesing n=ansible | TASK [Capture current hostname] *************************************************************************************************************************
2025-03-28 10:32:27,417 p=2702 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:32:27,426 p=2702 u=marwiesing n=ansible | TASK [Notify reboot start] ******************************************************************************************************************************
2025-03-28 10:32:27,441 p=2702 u=marwiesing n=ansible | ok: [rocky-1] => 
  msg: "\U0001F504 Rebooting rocky-1 (rocky-1)..."
2025-03-28 10:32:27,444 p=2702 u=marwiesing n=ansible | TASK [Reboot the node] **********************************************************************************************************************************
2025-03-28 10:32:45,361 p=2702 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:32:45,367 p=2702 u=marwiesing n=ansible | TASK [Wait for node to be Ready in Kubernetes] **********************************************************************************************************
2025-03-28 10:32:45,396 p=2702 u=marwiesing n=ansible | fatal: [rocky-1 -> control_plane]: UNREACHABLE! => changed=false 
  msg: 'Failed to connect to the host via ssh: ssh: Could not resolve hostname control_plane: Name or service not known'
  unreachable: true
2025-03-28 10:32:45,396 p=2702 u=marwiesing n=ansible | NO MORE HOSTS LEFT **************************************************************************************************************************************
2025-03-28 10:32:45,398 p=2702 u=marwiesing n=ansible | PLAY [Rolling reboot of Kubernetes worker nodes] ********************************************************************************************************
2025-03-28 10:32:45,400 p=2702 u=marwiesing n=ansible | TASK [Gathering Facts] **********************************************************************************************************************************
2025-03-28 10:32:46,761 p=2702 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:32:46,779 p=2702 u=marwiesing n=ansible | TASK [Capture current hostname] *************************************************************************************************************************
2025-03-28 10:32:47,086 p=2702 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:32:47,094 p=2702 u=marwiesing n=ansible | TASK [Notify reboot start] ******************************************************************************************************************************
2025-03-28 10:32:47,129 p=2702 u=marwiesing n=ansible | ok: [debian-1] => 
  msg: "\U0001F504 Rebooting debian-1 (debian-1)..."
2025-03-28 10:32:47,138 p=2702 u=marwiesing n=ansible | TASK [Reboot the node] **********************************************************************************************************************************
2025-03-28 10:33:03,180 p=2702 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:33:03,198 p=2702 u=marwiesing n=ansible | TASK [Wait for node to be Ready in Kubernetes] **********************************************************************************************************
2025-03-28 10:33:03,248 p=2702 u=marwiesing n=ansible | fatal: [debian-1 -> control_plane]: UNREACHABLE! => changed=false 
  msg: 'Failed to connect to the host via ssh: ssh: Could not resolve hostname control_plane: Name or service not known'
  unreachable: true
2025-03-28 10:33:03,249 p=2702 u=marwiesing n=ansible | NO MORE HOSTS LEFT **************************************************************************************************************************************
2025-03-28 10:33:03,250 p=2702 u=marwiesing n=ansible | PLAY RECAP **********************************************************************************************************************************************
2025-03-28 10:33:03,250 p=2702 u=marwiesing n=ansible | debian-1                   : ok=4    changed=2    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:33:03,251 p=2702 u=marwiesing n=ansible | rocky-1                    : ok=4    changed=2    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:33:03,251 p=2702 u=marwiesing n=ansible | ubuntu-2                   : ok=4    changed=2    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:35:50,036 p=4016 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-28 10:35:50,043 p=4016 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:35:51,630 p=4016 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:35:51,776 p=4016 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:35:51,822 p=4016 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:35:51,872 p=4016 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:35:51,902 p=4016 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-28 10:35:52,382 p=4016 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:35:52,483 p=4016 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:35:52,484 p=4016 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:35:52,484 p=4016 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:35:52,495 p=4016 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-28 10:35:52,927 p=4016 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:35:52,946 p=4016 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:35:52,960 p=4016 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:35:53,034 p=4016 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:35:53,041 p=4016 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-28 10:35:54,063 p=4016 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:35:54,179 p=4016 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:35:54,224 p=4016 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:35:54,348 p=4016 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:35:54,363 p=4016 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-28 10:35:55,001 p=4016 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:35:55,025 p=4016 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:35:55,083 p=4016 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:35:55,106 p=4016 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:35:55,193 p=4016 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-28 10:35:55,200 p=4016 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:35:56,330 p=4016 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:35:56,346 p=4016 u=marwiesing n=ansible | TASK [Pause for services to stabilize] ***********************************************************************************************************************************************************************************************************************
2025-03-28 10:35:56,365 p=4016 u=marwiesing n=ansible | Pausing for 5 seconds
2025-03-28 10:35:56,365 p=4016 u=marwiesing n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2025-03-28 10:36:01,369 p=4016 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:36:01,397 p=4016 u=marwiesing n=ansible | TASK [Check API server health endpoint] **********************************************************************************************************************************************************************************************************************
2025-03-28 10:36:02,084 p=4016 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:36:02,091 p=4016 u=marwiesing n=ansible | TASK [Display API health response] ***************************************************************************************************************************************************************************************************************************
2025-03-28 10:36:02,109 p=4016 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: 'Control plane API server health: ok'
2025-03-28 10:36:02,131 p=4016 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 10:36:02,131 p=4016 u=marwiesing n=ansible | debian-1                   : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:36:02,131 p=4016 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:36:02,132 p=4016 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:36:02,132 p=4016 u=marwiesing n=ansible | ubuntu-2                   : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:45:01,669 p=6240 u=marwiesing n=ansible | PLAY [Disable swap on Kubernetes nodes] **********************************************************************************************************************************************************************************************************************
2025-03-28 10:45:01,675 p=6240 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:45:03,594 p=6240 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 10:45:03,672 p=6240 u=marwiesing n=ansible | ok: [rocky-1]
2025-03-28 10:45:03,891 p=6240 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:45:03,957 p=6240 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:45:04,019 p=6240 u=marwiesing n=ansible | TASK [Disable swap immediately] ******************************************************************************************************************************************************************************************************************************
2025-03-28 10:45:04,041 p=6240 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 10:45:04,092 p=6240 u=marwiesing n=ansible | skipping: [rocky-1]
2025-03-28 10:45:04,104 p=6240 u=marwiesing n=ansible | skipping: [debian-1]
2025-03-28 10:45:04,435 p=6240 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:45:04,443 p=6240 u=marwiesing n=ansible | TASK [Comment out swapfile line in fstab] ********************************************************************************************************************************************************************************************************************
2025-03-28 10:45:05,019 p=6240 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 10:45:05,073 p=6240 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:45:05,094 p=6240 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:45:05,112 p=6240 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:45:05,128 p=6240 u=marwiesing n=ansible | TASK [Ensure kubelet service is restarted] *******************************************************************************************************************************************************************************************************************
2025-03-28 10:45:06,063 p=6240 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:45:06,091 p=6240 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:45:06,122 p=6240 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:45:06,169 p=6240 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:45:06,190 p=6240 u=marwiesing n=ansible | TASK [Display confirmation] **********************************************************************************************************************************************************************************************************************************
2025-03-28 10:45:06,966 p=6240 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 10:45:07,070 p=6240 u=marwiesing n=ansible | changed: [rocky-1]
2025-03-28 10:45:07,080 p=6240 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 10:45:07,197 p=6240 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:45:07,216 p=6240 u=marwiesing n=ansible | TASK [Show results] ******************************************************************************************************************************************************************************************************************************************
2025-03-28 10:45:07,277 p=6240 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |2-
  
    ==> Current swap status:
                   total        used        free      shared  buff/cache   available
    Mem:           9.7Gi       4.5Gi       3.0Gi       132Mi       2.7Gi       5.2Gi
    Swap:             0B          0B          0B
  
    ==> Current kubelet status:
    active
2025-03-28 10:45:07,312 p=6240 u=marwiesing n=ansible | ok: [ubuntu-2] => 
  msg: |2-
  
    ==> Current swap status:
                   total        used        free      shared  buff/cache   available
    Mem:           7.8Gi       461Mi       7.1Gi       760Ki       398Mi       7.3Gi
    Swap:             0B          0B          0B
  
    ==> Current kubelet status:
    active
2025-03-28 10:45:07,313 p=6240 u=marwiesing n=ansible | ok: [rocky-1] => 
  msg: |-
    \n==> Current swap status:
                   total        used        free      shared  buff/cache   available
    Mem:           7.5Gi       644Mi       6.6Gi       9.0Mi       563Mi       6.9Gi
    Swap:             0B          0B          0B
    \n==> Current kubelet status:
    active
2025-03-28 10:45:07,328 p=6240 u=marwiesing n=ansible | ok: [debian-1] => 
  msg: |2-
  
    ==> Current swap status:
                   total        used        free      shared  buff/cache   available
    Mem:           7.8Gi       3.2Gi       811Mi        38Mi       4.1Gi       4.5Gi
    Swap:             0B          0B          0B
  
    ==> Current kubelet status:
    active
2025-03-28 10:45:07,457 p=6240 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 10:45:07,458 p=6240 u=marwiesing n=ansible | debian-1                   : ok=5    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2025-03-28 10:45:07,458 p=6240 u=marwiesing n=ansible | rocky-1                    : ok=5    changed=3    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2025-03-28 10:45:07,458 p=6240 u=marwiesing n=ansible | ubuntu-1                   : ok=5    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
2025-03-28 10:45:07,458 p=6240 u=marwiesing n=ansible | ubuntu-2                   : ok=6    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 10:46:36,690 p=6732 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 10:46:36,697 p=6732 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:38,001 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:38,019 p=6732 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:38,545 p=6732 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:46:38,556 p=6732 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:38,925 p=6732 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:46:38,936 p=6732 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:39,351 p=6732 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:46:39,359 p=6732 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:39,824 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:39,832 p=6732 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:39,906 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:39,918 p=6732 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 10:46:40,288 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:40,295 p=6732 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 10:46:40,304 p=6732 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 10:46:40,312 p=6732 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:40,322 p=6732 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 10:46:40,328 p=6732 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 10:46:40,829 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:40,842 p=6732 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 10:46:41,185 p=6732 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 10:46:41,193 p=6732 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:41,589 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:41,604 p=6732 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:43,183 p=6732 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:00:01.305365'
  end: '2025-03-28 10:46:43.255079'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 10:46:41.949714'
  stderr: 'Error from server (NotFound): pods "prometheus-prometheus-node-exporter-m8t5s" not found'
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-qw7nl condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
    pod/prometheus-prometheus-node-exporter-5nwpf condition met
    pod/prometheus-prometheus-node-exporter-dpq2s condition met
    pod/prometheus-prometheus-node-exporter-lzcpr condition met
  stdout_lines: <omitted>
2025-03-28 10:46:43,183 p=6732 u=marwiesing n=ansible | ...ignoring
2025-03-28 10:46:43,191 p=6732 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:43,529 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:43,539 p=6732 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:44,025 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 10:46:44,037 p=6732 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:44,059 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                                     AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS              RESTARTS      AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running             0             5m37s   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running             0             5m38s   10.32.0.5       debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running             4 (25m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running             4 (25m ago)   2d      10.44.0.4       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-qw7nl                      3/3     Running             0             7m58s   10.32.0.30      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running             0             7m57s   10.32.0.29      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running             0             7m58s   10.32.0.33      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running             0             5m37s   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-5nwpf                0/1     Error               0             20m     192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-8qnk7                0/1     ContainerCreating   0             1s      192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-dpq2s                1/1     Running             0             5s      192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-f8nd5                1/1     Running             0             2s      192.168.0.56    rocky-1    <none>           <none>
    prometheus-prometheus-node-exporter-lzcpr                1/1     Running             0             4s      192.168.0.240   ubuntu-2   <none>           <none>
2025-03-28 10:46:44,069 p=6732 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:44,101 p=6732 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                                     AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS              RESTARTS      AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running             0             5m37s   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running             0             5m38s   10.32.0.5       debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running             4 (25m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running             4 (25m ago)   2d      10.44.0.4       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-qw7nl                      3/3     Running             0             7m58s   10.32.0.30      debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running             0             7m57s   10.32.0.29      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running             0             7m58s   10.32.0.33      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running             0             5m37s   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-5nwpf                0/1     Error               0             20m     192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-8qnk7                0/1     ContainerCreating   0             1s      192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-dpq2s                1/1     Running             0             5s      192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-f8nd5                1/1     Running             0             2s      192.168.0.56    rocky-1    <none>           <none>
    prometheus-prometheus-node-exporter-lzcpr                1/1     Running             0             4s      192.168.0.240   ubuntu-2   <none>           <none>
2025-03-28 10:46:44,161 p=6732 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 10:46:44,161 p=6732 u=marwiesing n=ansible | ubuntu-1                   : ok=15   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 11:09:25,376 p=2487 u=marwiesing n=ansible | PLAY [Repair Kubernetes services after reboot on all nodes] **************************************************************************************************************************************************************************************************
2025-03-28 11:09:25,389 p=2487 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:09:27,085 p=2487 u=marwiesing n=ansible | ok: [debian-1]
2025-03-28 11:09:27,342 p=2487 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:09:27,420 p=2487 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 11:09:28,527 p=2487 u=marwiesing n=ansible | fatal: [rocky-1]: UNREACHABLE! => changed=false 
  msg: 'Failed to connect to the host via ssh: ssh: connect to host 192.168.0.56 port 22: No route to host'
  unreachable: true
2025-03-28 11:09:28,553 p=2487 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve directory exists] **********************************************************************************************************************************************************************************************************
2025-03-28 11:09:28,970 p=2487 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 11:09:29,026 p=2487 u=marwiesing n=ansible | ok: [ubuntu-2]
2025-03-28 11:09:29,105 p=2487 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:09:29,115 p=2487 u=marwiesing n=ansible | TASK [Ensure /run/systemd/resolve/resolv.conf is a symlink to /etc/resolv.conf] ******************************************************************************************************************************************************************************
2025-03-28 11:09:29,437 p=2487 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 11:09:29,481 p=2487 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:09:29,498 p=2487 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 11:09:29,509 p=2487 u=marwiesing n=ansible | TASK [Restart containerd service] ****************************************************************************************************************************************************************************************************************************
2025-03-28 11:09:30,470 p=2487 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 11:09:30,676 p=2487 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 11:09:30,709 p=2487 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:09:30,722 p=2487 u=marwiesing n=ansible | TASK [Restart kubelet service] *******************************************************************************************************************************************************************************************************************************
2025-03-28 11:09:31,292 p=2487 u=marwiesing n=ansible | changed: [ubuntu-2]
2025-03-28 11:09:31,385 p=2487 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:09:31,416 p=2487 u=marwiesing n=ansible | changed: [debian-1]
2025-03-28 11:09:31,516 p=2487 u=marwiesing n=ansible | PLAY [Verify control plane API server health] ****************************************************************************************************************************************************************************************************************
2025-03-28 11:09:31,526 p=2487 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:09:32,508 p=2487 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:09:32,533 p=2487 u=marwiesing n=ansible | TASK [Pause for services to stabilize] ***********************************************************************************************************************************************************************************************************************
2025-03-28 11:09:32,558 p=2487 u=marwiesing n=ansible | Pausing for 5 seconds
2025-03-28 11:09:32,558 p=2487 u=marwiesing n=ansible | (ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
2025-03-28 11:09:37,560 p=2487 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:09:37,567 p=2487 u=marwiesing n=ansible | TASK [Check API server health endpoint] **********************************************************************************************************************************************************************************************************************
2025-03-28 11:09:38,733 p=2487 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:09:38,749 p=2487 u=marwiesing n=ansible | TASK [Display API health response] ***************************************************************************************************************************************************************************************************************************
2025-03-28 11:09:38,771 p=2487 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: 'Control plane API server health: ok'
2025-03-28 11:09:38,795 p=2487 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 11:09:38,796 p=2487 u=marwiesing n=ansible | debian-1                   : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 11:09:38,796 p=2487 u=marwiesing n=ansible | rocky-1                    : ok=0    changed=0    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 11:09:38,796 p=2487 u=marwiesing n=ansible | ubuntu-1                   : ok=9    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 11:09:38,796 p=2487 u=marwiesing n=ansible | ubuntu-2                   : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-03-28 11:10:02,280 p=2808 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 11:10:02,287 p=2808 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:03,392 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:10:03,422 p=2808 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:03,982 p=2808 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:10:03,988 p=2808 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:04,339 p=2808 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:10:04,350 p=2808 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:04,814 p=2808 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:10:04,825 p=2808 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:05,511 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:10:05,523 p=2808 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:05,619 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:10:05,635 p=2808 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 11:10:06,075 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:10:06,087 p=2808 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 11:10:06,104 p=2808 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 11:10:06,114 p=2808 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:06,130 p=2808 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 11:10:06,142 p=2808 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 11:10:06,612 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:10:06,621 p=2808 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 11:10:06,990 p=2808 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:10:06,999 p=2808 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 11:10:07,365 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:10:07,379 p=2808 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 11:11:07,711 p=2808 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.052455'
  end: '2025-03-28 11:11:07.787075'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 11:10:07.734620'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-grafana-6c59f78f66-qw7nl
    timed out waiting for the condition on pods/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46
    timed out waiting for the condition on pods/prometheus-kube-state-metrics-5bc7f89f46-kdw7r
    timed out waiting for the condition on pods/prometheus-prometheus-kube-prometheus-prometheus-0
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-8qnk7
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-dpq2s
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-f8nd5
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-lzcpr
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
  stdout_lines: <omitted>
2025-03-28 11:11:07,711 p=2808 u=marwiesing n=ansible | ...ignoring
2025-03-28 11:11:07,718 p=2808 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:11:08,009 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:11:08,016 p=2808 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 11:11:08,319 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:11:08,350 p=2808 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 11:11:08,439 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                                     AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS        AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (9m10s ago)   30m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (9m10s ago)   30m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (9m10s ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (4m4s ago)    2d1h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-qw7nl                      2/3     CrashLoopBackOff   5 (33s ago)     32m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (9m10s ago)   32m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (9m10s ago)   32m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (9m10s ago)   30m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-8qnk7                1/1     Running            1 (9m10s ago)   24m    192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-dpq2s                1/1     Running            3 (4m5s ago)    24m    192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-f8nd5                1/1     Terminating        0               24m    192.168.0.56    rocky-1    <none>           <none>
    prometheus-prometheus-node-exporter-lzcpr                1/1     Running            2 (3m36s ago)   24m    192.168.0.240   ubuntu-2   <none>           <none>
2025-03-28 11:11:08,452 p=2808 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 11:11:08,476 p=2808 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                                     AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS        AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (9m10s ago)   30m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (9m10s ago)   30m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (9m10s ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (4m4s ago)    2d1h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-qw7nl                      2/3     CrashLoopBackOff   5 (33s ago)     32m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (9m10s ago)   32m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (9m10s ago)   32m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (9m10s ago)   30m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-8qnk7                1/1     Running            1 (9m10s ago)   24m    192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-dpq2s                1/1     Running            3 (4m5s ago)    24m    192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-f8nd5                1/1     Terminating        0               24m    192.168.0.56    rocky-1    <none>           <none>
    prometheus-prometheus-node-exporter-lzcpr                1/1     Running            2 (3m36s ago)   24m    192.168.0.240   ubuntu-2   <none>           <none>
2025-03-28 11:11:08,511 p=2808 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 11:11:08,511 p=2808 u=marwiesing n=ansible | ubuntu-1                   : ok=15   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 11:49:12,371 p=11410 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 11:49:12,378 p=11410 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:49:13,612 p=11410 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:49:13,632 p=11410 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:49:14,048 p=11410 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"}
      {"op": "replace", "path": "/spec/template/spec/containers/0/args/6", "value": "--web.listen-address=0.0.0.0:19100"}
    ]
  delta: '0:00:00.040463'
  end: '2025-03-28 11:49:14.131003'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 11:49:14.090540'
  stderr: 'error: unable to parse "[\n  {\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/livenessProbe/httpGet/port\", \"value\": 19100},\n  {\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/readinessProbe/httpGet/port\", \"value\": 19100},\n  {\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/ports/0/containerPort\", \"value\": 19100},\n  {\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/ports/0/name\", \"value\": \"metrics-19100\"}\n  {\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/args/6\", \"value\": \"--web.listen-address=0.0.0.0:19100\"}\n]": yaml: line 5: did not find expected '','' or '']'''
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 11:49:14,049 p=11410 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 11:49:14,049 p=11410 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 11:50:03,148 p=11626 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 11:50:03,155 p=11626 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:50:04,184 p=11626 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:50:04,200 p=11626 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:50:04,631 p=11626 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/args/6", "value": "--web.listen-address=0.0.0.0:19100"}
    ]
  delta: '0:00:00.064831'
  end: '2025-03-28 11:50:04.710912'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 11:50:04.646081'
  stderr: 'The DaemonSet "prometheus-prometheus-node-exporter" is invalid: spec.template.spec.containers[0].ports[1].name: Duplicate value: "metrics-19100"'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 11:50:04,632 p=11626 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 11:50:04,632 p=11626 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 11:51:16,926 p=11925 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 11:51:16,935 p=11925 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:51:18,216 p=11925 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:51:18,230 p=11925 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:51:18,658 p=11925 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/args/6", "value": "--web.listen-address=0.0.0.0:19100"}
    ]
  delta: '0:00:00.057839'
  end: '2025-03-28 11:51:18.744710'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 11:51:18.686871'
  stderr: 'The DaemonSet "prometheus-prometheus-node-exporter" is invalid: spec.template.spec.containers[0].ports[1].name: Duplicate value: "metrics-19100"'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 11:51:18,659 p=11925 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 11:51:18,659 p=11925 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 11:53:38,154 p=12458 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 11:53:38,160 p=12458 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:39,498 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:39,511 p=12458 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:40,036 p=12458 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:53:40,046 p=12458 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:40,445 p=12458 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:53:40,456 p=12458 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:40,806 p=12458 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 11:53:40,815 p=12458 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:41,166 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:41,173 p=12458 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:41,212 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:41,222 p=12458 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 11:53:41,549 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:41,555 p=12458 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 11:53:41,569 p=12458 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 11:53:41,589 p=12458 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:41,610 p=12458 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 11:53:41,626 p=12458 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 11:53:42,065 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:42,072 p=12458 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 11:53:42,362 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:42,373 p=12458 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:42,669 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:42,676 p=12458 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:44,032 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:44,042 p=12458 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:44,357 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:44,364 p=12458 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:44,702 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 11:53:44,709 p=12458 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:44,731 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (51m ago)   72m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (51m ago)   72m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (51m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (46m ago)   2d1h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0             30m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (51m ago)   74m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (51m ago)   74m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (51m ago)   72m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0             15m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0             15m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 11:53:44,742 p=12458 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:44,773 p=12458 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS    RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (51m ago)   72m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (51m ago)   72m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (51m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (46m ago)   2d1h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0             30m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (51m ago)   74m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (51m ago)   74m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (51m ago)   72m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0             15m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0             15m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 11:53:44,805 p=12458 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 11:53:44,805 p=12458 u=marwiesing n=ansible | ubuntu-1                   : ok=15   changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
2025-03-28 12:03:07,992 p=14582 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:03:07,999 p=14582 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:09,286 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:09,304 p=14582 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:09,724 p=14582 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:03:09,730 p=14582 u=marwiesing n=ansible | TASK [Add toleration to allow Node Exporter on control plane] ************************************************************************************************************************************************************************************************
2025-03-28 12:03:10,064 p=14582 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:03:10,074 p=14582 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:10,467 p=14582 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:03:10,477 p=14582 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:10,864 p=14582 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:03:10,871 p=14582 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:11,192 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:11,198 p=14582 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:11,272 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:11,282 p=14582 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 12:03:11,643 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:11,652 p=14582 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 12:03:11,663 p=14582 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:03:11,668 p=14582 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:11,680 p=14582 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:03:11,688 p=14582 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 12:03:12,071 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:12,078 p=14582 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 12:03:12,358 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:12,364 p=14582 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:12,655 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:12,664 p=14582 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:14,012 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:14,022 p=14582 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:14,371 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:14,378 p=14582 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:14,699 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:03:14,706 p=14582 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:14,725 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (61m ago)   82m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (61m ago)   82m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (61m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (56m ago)   2d1h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0             40m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (61m ago)   84m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (61m ago)   84m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (61m ago)   82m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0             25m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0             25m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 12:03:14,731 p=14582 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:14,749 p=14582 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS    RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (61m ago)   82m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (61m ago)   82m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (61m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (56m ago)   2d1h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0             40m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (61m ago)   84m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (61m ago)   84m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (61m ago)   82m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0             25m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0             25m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 12:03:14,781 p=14582 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:03:14,781 p=14582 u=marwiesing n=ansible | ubuntu-1                   : ok=16   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
2025-03-28 12:07:34,324 p=15644 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:07:34,331 p=15644 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:35,641 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:35,655 p=15644 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:36,095 p=15644 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:07:36,102 p=15644 u=marwiesing n=ansible | TASK [Add toleration to allow Node Exporter on control plane] ************************************************************************************************************************************************************************************************
2025-03-28 12:07:36,493 p=15644 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:07:36,503 p=15644 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:36,867 p=15644 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:07:36,873 p=15644 u=marwiesing n=ansible | TASK [Patch Node Exporter container ports to remove duplicates] **********************************************************************************************************************************************************************************************
2025-03-28 12:07:37,259 p=15644 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:07:37,268 p=15644 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:37,690 p=15644 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:07:37,698 p=15644 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:38,079 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:38,085 p=15644 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:38,127 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:38,141 p=15644 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 12:07:38,487 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:38,501 p=15644 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 12:07:38,515 p=15644 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:07:38,525 p=15644 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:38,543 p=15644 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:07:38,554 p=15644 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 12:07:38,937 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:38,946 p=15644 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 12:07:39,292 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:39,298 p=15644 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 12:07:39,584 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:07:39,592 p=15644 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 12:08:39,918 p=15644 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.056055'
  end: '2025-03-28 12:08:40.010635'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 12:07:39.954580'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-brwb8
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-m5qwf
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-rdnv7
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
  stdout_lines: <omitted>
2025-03-28 12:08:39,918 p=15644 u=marwiesing n=ansible | ...ignoring
2025-03-28 12:08:39,928 p=15644 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:08:40,280 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:08:40,291 p=15644 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:08:40,643 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:08:40,650 p=15644 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 12:08:40,671 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (66m ago)   87m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (66m ago)   87m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (66m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (61m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             45m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (66m ago)   89m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (66m ago)   89m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (66m ago)   87m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-brwb8                0/1     CrashLoopBackOff   3 (18s ago)   63s    192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             30m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             30m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 12:08:40,683 p=15644 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 12:08:40,710 p=15644 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (66m ago)   87m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (66m ago)   87m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (66m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (61m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             45m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (66m ago)   89m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (66m ago)   89m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (66m ago)   87m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-brwb8                0/1     CrashLoopBackOff   3 (18s ago)   63s    192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             30m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             30m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 12:08:40,755 p=15644 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:08:40,756 p=15644 u=marwiesing n=ansible | ubuntu-1                   : ok=17   changed=5    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 12:10:23,954 p=16397 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:10:23,961 p=16397 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:25,211 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:25,226 p=16397 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:25,642 p=16397 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:10:25,650 p=16397 u=marwiesing n=ansible | TASK [Add toleration to allow Node Exporter on control plane] ************************************************************************************************************************************************************************************************
2025-03-28 12:10:26,059 p=16397 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:10:26,068 p=16397 u=marwiesing n=ansible | TASK [Remove invalid --web.listen-address from DaemonSet args] ***********************************************************************************************************************************************************************************************
2025-03-28 12:10:26,544 p=16397 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:10:26,551 p=16397 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:26,963 p=16397 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:10:26,973 p=16397 u=marwiesing n=ansible | TASK [Patch Node Exporter container ports to remove duplicates] **********************************************************************************************************************************************************************************************
2025-03-28 12:10:27,420 p=16397 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:10:27,430 p=16397 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:27,849 p=16397 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:10:27,858 p=16397 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:28,195 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:28,207 p=16397 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:28,286 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:28,306 p=16397 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 12:10:28,654 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:28,661 p=16397 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 12:10:28,672 p=16397 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:10:28,683 p=16397 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:28,703 p=16397 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:10:28,715 p=16397 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 12:10:29,103 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:29,111 p=16397 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 12:10:29,409 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:29,417 p=16397 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 12:10:29,705 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:10:29,715 p=16397 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 12:11:30,047 p=16397 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.053789'
  end: '2025-03-28 12:11:30.134933'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 12:10:30.081144'
  stderr: 'error: timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-xswbx'
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
    pod/prometheus-prometheus-node-exporter-m5qwf condition met
    pod/prometheus-prometheus-node-exporter-rdnv7 condition met
  stdout_lines: <omitted>
2025-03-28 12:11:30,048 p=16397 u=marwiesing n=ansible | ...ignoring
2025-03-28 12:11:30,059 p=16397 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:11:30,391 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:11:30,397 p=16397 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:11:30,731 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:11:30,739 p=16397 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 12:11:30,758 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (69m ago)   90m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (69m ago)   90m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (69m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (64m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             48m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (69m ago)   92m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (69m ago)   92m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (69m ago)   90m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             33m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             33m    192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-xswbx                0/1     CrashLoopBackOff   3 (17s ago)   63s    192.168.0.100   ubuntu     <none>           <none>
2025-03-28 12:11:30,774 p=16397 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 12:11:30,799 p=16397 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (69m ago)   90m    10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (69m ago)   90m    10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (69m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (64m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             48m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (69m ago)   92m    10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (69m ago)   92m    10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (69m ago)   90m    10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             33m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             33m    192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-xswbx                0/1     CrashLoopBackOff   3 (17s ago)   63s    192.168.0.100   ubuntu     <none>           <none>
2025-03-28 12:11:30,834 p=16397 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:11:30,834 p=16397 u=marwiesing n=ansible | ubuntu-1                   : ok=18   changed=6    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 12:20:15,218 p=18653 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:20:15,227 p=18653 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:20:16,496 p=18653 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:20:16,512 p=18653 u=marwiesing n=ansible | TASK [Patch DaemonSet args (set listen-address to port 19100)] ***********************************************************************************************************************************************************************************************
2025-03-28 12:20:16,974 p=18653 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/args/6", "value": "--web.listen-address=0.0.0.0:19100"}
    ]
  delta: '0:00:00.062761'
  end: '2025-03-28 12:20:17.062847'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 12:20:17.000086'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 12:20:16,974 p=18653 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:20:16,975 p=18653 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 12:20:39,880 p=18781 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:20:39,886 p=18781 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:20:40,939 p=18781 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:20:40,961 p=18781 u=marwiesing n=ansible | TASK [Patch DaemonSet args (set listen-address to port 19100)] ***********************************************************************************************************************************************************************************************
2025-03-28 12:20:41,425 p=18781 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/template/spec/containers/0/args/6", "value": "--web.listen-address=0.0.0.0:19100"}
    ]
  delta: '0:00:00.063747'
  end: '2025-03-28 12:20:41.517444'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 12:20:41.453697'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 12:20:41,426 p=18781 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:20:41,426 p=18781 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 12:24:21,731 p=19611 u=marwiesing n=ansible | PLAY [Clean patch for Prometheus and Grafana] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:24:21,738 p=19611 u=marwiesing n=ansible | TASK [Patch Node Exporter args (append --web.listen-address=0.0.0.0:19100)] **********************************************************************************************************************************************************************************
2025-03-28 12:24:22,462 p=19611 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:24:22,464 p=19611 u=marwiesing n=ansible | TASK [Clean Node Exporter container ports] *******************************************************************************************************************************************************************************************************************
2025-03-28 12:24:22,851 p=19611 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:24:22,854 p=19611 u=marwiesing n=ansible | TASK [Patch probes to use 19100] *****************************************************************************************************************************************************************************************************************************
2025-03-28 12:24:23,219 p=19611 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:24:23,221 p=19611 u=marwiesing n=ansible | TASK [Allow control plane node for Node Exporter] ************************************************************************************************************************************************************************************************************
2025-03-28 12:24:23,630 p=19611 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:24:23,632 p=19611 u=marwiesing n=ansible | TASK [Patch Node Exporter service to 19100] ******************************************************************************************************************************************************************************************************************
2025-03-28 12:24:24,028 p=19611 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:24:24,030 p=19611 u=marwiesing n=ansible | TASK [Restart Node Exporter DaemonSet] ***********************************************************************************************************************************************************************************************************************
2025-03-28 12:24:24,452 p=19611 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:24:24,453 p=19611 u=marwiesing n=ansible | TASK [Patch Grafana (example  add annotation)] **************************************************************************************************************************************************************************************************************
2025-03-28 12:24:24,469 p=19611 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => 
  msg: |-
    The task includes an option with an undefined variable. The error was: 'ansible_date_time' is undefined. 'ansible_date_time' is undefined
  
    The error appears to be in '/home/marwiesing/playground/ansible/00_Repair_Playbooks/02_patch_k8s_daemonset.yml': line 81, column 5, but may
    be elsewhere in the file depending on the exact syntax problem.
  
    The offending line appears to be:
  
  
      - name: Patch Grafana (example  add annotation)
        ^ here
2025-03-28 12:24:24,469 p=19611 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:24:24,470 p=19611 u=marwiesing n=ansible | ubuntu-1                   : ok=6    changed=6    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 12:26:45,870 p=20177 u=marwiesing n=ansible | PLAY [Patch Prometheus Node Exporter and handle crashed Pods] ************************************************************************************************************************************************************************************************
2025-03-28 12:26:45,876 p=20177 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:26:47,187 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:47,202 p=20177 u=marwiesing n=ansible | TASK [Add toleration for control-plane node] *****************************************************************************************************************************************************************************************************************
2025-03-28 12:26:47,665 p=20177 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:26:47,679 p=20177 u=marwiesing n=ansible | TASK [Patch DaemonSet to fix ports and probes for port 19100] ************************************************************************************************************************************************************************************************
2025-03-28 12:26:48,204 p=20177 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:26:48,213 p=20177 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:26:48,724 p=20177 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:26:48,734 p=20177 u=marwiesing n=ansible | TASK [Patch Node Exporter Service to 19100] ******************************************************************************************************************************************************************************************************************
2025-03-28 12:26:49,097 p=20177 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:26:49,107 p=20177 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 12:26:49,474 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:49,486 p=20177 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 12:26:49,529 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:49,543 p=20177 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 12:26:49,996 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:50,004 p=20177 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 12:26:50,017 p=20177 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:26:50,024 p=20177 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 12:26:50,037 p=20177 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:26:50,045 p=20177 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 12:26:50,427 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:50,434 p=20177 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 12:26:50,753 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:50,762 p=20177 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 12:26:51,077 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:26:51,087 p=20177 u=marwiesing n=ansible | TASK [Wait for Node Exporter Pods to become Ready] ***********************************************************************************************************************************************************************************************************
2025-03-28 12:27:51,409 p=20177 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - -l
  - app.kubernetes.io/name=prometheus-node-exporter
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.045199'
  end: '2025-03-28 12:27:51.506538'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 12:26:51.461339'
  stderr: 'error: timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-sqdbc'
  stderr_lines: <omitted>
  stdout: |-
    pod/prometheus-prometheus-node-exporter-m5qwf condition met
    pod/prometheus-prometheus-node-exporter-rdnv7 condition met
  stdout_lines: <omitted>
2025-03-28 12:27:51,410 p=20177 u=marwiesing n=ansible | ...ignoring
2025-03-28 12:27:51,418 p=20177 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:27:51,752 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:27:51,759 p=20177 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:27:52,143 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:27:52,150 p=20177 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 12:27:52,169 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
  
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (85m ago)   106m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (85m ago)   106m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (85m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (80m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             64m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (85m ago)   109m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (85m ago)   109m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (85m ago)   106m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             49m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             50m    192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-sqdbc                0/1     CrashLoopBackOff   3 (9s ago)    63s    192.168.0.100   ubuntu     <none>           <none>
2025-03-28 12:27:52,175 p=20177 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 12:27:52,193 p=20177 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter patched and restarted
     Toleration added for control-plane node
     Probes, ports, and args set to 19100
     Crashed pods force deleted (if any)
     Current endpoints:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current pod overview:
      NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (85m ago)   106m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (85m ago)   106m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (85m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (80m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             64m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (85m ago)   109m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (85m ago)   109m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (85m ago)   106m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             49m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             50m    192.168.0.242   debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-sqdbc                0/1     CrashLoopBackOff   3 (9s ago)    63s    192.168.0.100   ubuntu     <none>           <none>
2025-03-28 12:27:52,214 p=20177 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:27:52,214 p=20177 u=marwiesing n=ansible | ubuntu-1                   : ok=16   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 12:29:57,233 p=20977 u=marwiesing n=ansible | PLAY [Patch Prometheus Node Exporter and handle crashed Pods] ************************************************************************************************************************************************************************************************
2025-03-28 12:29:57,242 p=20977 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:29:58,582 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:29:58,603 p=20977 u=marwiesing n=ansible | TASK [Add toleration for control-plane node] *****************************************************************************************************************************************************************************************************************
2025-03-28 12:29:59,086 p=20977 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:29:59,094 p=20977 u=marwiesing n=ansible | TASK [Patch DaemonSet to fix ports and probes for port 19100] ************************************************************************************************************************************************************************************************
2025-03-28 12:29:59,488 p=20977 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:29:59,499 p=20977 u=marwiesing n=ansible | TASK [Clean up all --web.listen-address args] ****************************************************************************************************************************************************************************************************************
2025-03-28 12:29:59,921 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:29:59,932 p=20977 u=marwiesing n=ansible | TASK [Add --web.listen-address=0.0.0.0:19100 to args] ********************************************************************************************************************************************************************************************************
2025-03-28 12:30:00,433 p=20977 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:30:00,444 p=20977 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:30:00,862 p=20977 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:30:00,868 p=20977 u=marwiesing n=ansible | TASK [Patch Node Exporter Service to 19100] ******************************************************************************************************************************************************************************************************************
2025-03-28 12:30:01,181 p=20977 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 12:30:01,187 p=20977 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 12:30:01,608 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:30:01,617 p=20977 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 12:30:01,659 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:30:01,669 p=20977 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 12:30:02,050 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:30:02,060 p=20977 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 12:30:02,076 p=20977 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:30:02,087 p=20977 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 12:30:02,103 p=20977 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 12:30:02,115 p=20977 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 12:30:02,570 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:30:02,578 p=20977 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 12:30:02,882 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:30:02,889 p=20977 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 12:30:03,208 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:30:03,214 p=20977 u=marwiesing n=ansible | TASK [Wait for Node Exporter Pods to become Ready] ***********************************************************************************************************************************************************************************************************
2025-03-28 12:31:03,545 p=20977 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - -l
  - app.kubernetes.io/name=prometheus-node-exporter
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.045810'
  end: '2025-03-28 12:31:03.636661'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 12:30:03.590851'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-4bmh7
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-m5qwf
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-rdnv7
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 12:31:03,545 p=20977 u=marwiesing n=ansible | ...ignoring
2025-03-28 12:31:03,553 p=20977 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 12:31:03,936 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:31:03,947 p=20977 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 12:31:04,395 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 12:31:04,404 p=20977 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 12:31:04,425 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
  
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (89m ago)   109m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (89m ago)   109m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (89m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (84m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             67m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (89m ago)   112m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (89m ago)   112m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (89m ago)   109m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4bmh7                0/1     CrashLoopBackOff   3 (18s ago)   63s    192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             53m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             53m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 12:31:04,439 p=20977 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 12:31:04,463 p=20977 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter patched and restarted
     Toleration added for control-plane node
     Probes, ports, and args set to 19100
     Crashed pods force deleted (if any)
     Current endpoints:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current pod overview:
      NAME                                                     READY   STATUS             RESTARTS      AGE    IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (89m ago)   109m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (89m ago)   109m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (89m ago)   12d    10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (84m ago)   2d2h   10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0             67m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (89m ago)   112m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (89m ago)   112m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (89m ago)   109m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-4bmh7                0/1     CrashLoopBackOff   3 (18s ago)   63s    192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0             53m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0             53m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 12:31:04,482 p=20977 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 12:31:04,482 p=20977 u=marwiesing n=ansible | ubuntu-1                   : ok=18   changed=5    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 13:52:10,388 p=38577 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 13:52:10,395 p=38577 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:11,709 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:11,729 p=38577 u=marwiesing n=ansible | TASK [Remove invalid from DaemonSet args] ********************************************************************************************************************************************************************************************************************
2025-03-28 13:52:12,253 p=38577 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 13:52:12,261 p=38577 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:12,696 p=38577 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 13:52:12,708 p=38577 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:13,104 p=38577 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 13:52:13,110 p=38577 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:13,587 p=38577 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 13:52:13,593 p=38577 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:13,964 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:13,973 p=38577 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:14,014 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:14,021 p=38577 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 13:52:14,361 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:14,370 p=38577 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 13:52:14,381 p=38577 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 13:52:14,391 p=38577 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:14,409 p=38577 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 13:52:14,419 p=38577 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 13:52:14,792 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:14,801 p=38577 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 13:52:15,116 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:15,124 p=38577 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:15,413 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:15,419 p=38577 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:16,765 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:16,771 p=38577 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:17,088 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:17,093 p=38577 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:17,443 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 13:52:17,453 p=38577 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:17,477 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (170m ago)   3h11m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (170m ago)   3h11m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (170m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (165m ago)   2d3h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0              149m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (170m ago)   3h13m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (170m ago)   3h13m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (170m ago)   3h11m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0              134m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0              134m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 13:52:17,488 p=38577 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:17,516 p=38577 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS    RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (170m ago)   3h11m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (170m ago)   3h11m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (170m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (165m ago)   2d3h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0              149m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (170m ago)   3h13m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (170m ago)   3h13m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (170m ago)   3h11m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0              134m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0              134m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 13:52:17,553 p=38577 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 13:52:17,553 p=38577 u=marwiesing n=ansible | ubuntu-1                   : ok=16   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
2025-03-28 14:02:09,563 p=40819 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:02:09,569 p=40819 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:10,872 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:10,886 p=40819 u=marwiesing n=ansible | TASK [Remove invalid from DaemonSet args] ********************************************************************************************************************************************************************************************************************
2025-03-28 14:02:11,336 p=40819 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:02:11,343 p=40819 u=marwiesing n=ansible | TASK [Patch DaemonSet with tolerations] **********************************************************************************************************************************************************************************************************************
2025-03-28 14:02:11,687 p=40819 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:02:11,693 p=40819 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:12,029 p=40819 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:02:12,037 p=40819 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:12,454 p=40819 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:02:12,464 p=40819 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:12,812 p=40819 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:02:12,820 p=40819 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:13,144 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:13,151 p=40819 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:13,192 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:13,198 p=40819 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 14:02:13,511 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:13,520 p=40819 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 14:02:13,535 p=40819 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 14:02:13,543 p=40819 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:13,568 p=40819 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 14:02:13,580 p=40819 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 14:02:13,939 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:13,948 p=40819 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 14:02:14,248 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:14,258 p=40819 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:14,535 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:14,542 p=40819 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:15,874 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:15,881 p=40819 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:16,254 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:16,265 p=40819 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:16,614 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:02:16,623 p=40819 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:16,640 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (3h ago)     3h21m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (3h ago)     3h21m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (3h ago)     12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (175m ago)   2d3h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0              159m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (3h ago)     3h23m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (3h ago)     3h23m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (3h ago)     3h21m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0              144m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0              144m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 14:02:16,646 p=40819 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:16,664 p=40819 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS    RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (3h ago)     3h21m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (3h ago)     3h21m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (3h ago)     12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (175m ago)   2d3h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0              159m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (3h ago)     3h23m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (3h ago)     3h23m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (3h ago)     3h21m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running   0              144m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running   0              144m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 14:02:16,687 p=40819 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:02:16,687 p=40819 u=marwiesing n=ansible | ubuntu-1                   : ok=17   changed=5    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
2025-03-28 14:10:27,129 p=42713 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:10:27,136 p=42713 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:29,429 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:29,445 p=42713 u=marwiesing n=ansible | TASK [Clean up args, probes, and ports in DaemonSet] *********************************************************************************************************************************************************************************************************
2025-03-28 14:10:29,910 p=42713 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:10:29,919 p=42713 u=marwiesing n=ansible | TASK [Patch DaemonSet with tolerations] **********************************************************************************************************************************************************************************************************************
2025-03-28 14:10:30,333 p=42713 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:10:30,341 p=42713 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:30,732 p=42713 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:10:30,740 p=42713 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:31,104 p=42713 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:10:31,111 p=42713 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:31,531 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:31,540 p=42713 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:31,608 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:31,620 p=42713 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 14:10:31,987 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:31,996 p=42713 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 14:10:32,006 p=42713 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 14:10:32,012 p=42713 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:32,024 p=42713 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 14:10:32,030 p=42713 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 14:10:32,530 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:32,538 p=42713 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 14:10:32,823 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:32,832 p=42713 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 14:10:33,149 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:10:33,159 p=42713 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 14:11:33,487 p=42713 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.046189'
  end: '2025-03-28 14:11:33.606771'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:10:33.560582'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-jnncm
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-m5qwf
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-rdnv7
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
  stdout_lines: <omitted>
2025-03-28 14:11:33,487 p=42713 u=marwiesing n=ansible | ...ignoring
2025-03-28 14:11:33,494 p=42713 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:11:33,813 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:11:33,820 p=42713 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 14:11:34,202 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:11:34,215 p=42713 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 14:11:34,246 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (3h9m ago)   3h30m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (3h9m ago)   3h30m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (3h9m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (3h4m ago)   2d4h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0              168m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (3h9m ago)   3h32m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (3h9m ago)   3h32m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (3h9m ago)   3h30m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-jnncm                0/1     CrashLoopBackOff   3 (7s ago)     63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0              153m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0              153m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 14:11:34,266 p=42713 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 14:11:34,294 p=42713 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (3h9m ago)   3h30m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (3h9m ago)   3h30m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (3h9m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (3h4m ago)   2d4h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0              168m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (3h9m ago)   3h32m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (3h9m ago)   3h32m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (3h9m ago)   3h30m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-jnncm                0/1     CrashLoopBackOff   3 (7s ago)     63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0              153m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0              153m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 14:11:34,324 p=42713 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:11:34,324 p=42713 u=marwiesing n=ansible | ubuntu-1                   : ok=16   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 14:23:40,582 p=45651 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:23:40,591 p=45651 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:23:41,884 p=45651 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:23:41,898 p=45651 u=marwiesing n=ansible | TASK [Patch DaemonSet for args, probes, ports, and fix duplicate port] ***************************************************************************************************************************************************************************************
2025-03-28 14:23:42,340 p=45651 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=true 
  changed_when_result: 'The conditional check ''''patched'' in patch_combined_cleanup.stdout or patch_combined_cleanup.rc == 0'' failed. The error was: error while evaluating conditional (''patched'' in patch_combined_cleanup.stdout or patch_combined_cleanup.rc == 0): ''patch_combined_cleanup'' is undefined. ''patch_combined_cleanup'' is undefined'
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--web.listen-address=:19100" },
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.077821'
  end: '2025-03-28 14:23:42.461306'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:23:42.383485'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 14:23:42,341 p=45651 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:23:42,341 p=45651 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 14:24:59,730 p=45964 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:24:59,737 p=45964 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:25:01,021 p=45964 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:25:01,043 p=45964 u=marwiesing n=ansible | TASK [Patch DaemonSet for args, probes, ports, and fix duplicate port] ***************************************************************************************************************************************************************************************
2025-03-28 14:25:01,470 p=45964 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--web.listen-address=:19100"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.059746'
  end: '2025-03-28 14:25:01.593466'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:25:01.533720'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 14:25:01,470 p=45964 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:25:01,471 p=45964 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 14:26:14,404 p=46254 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:26:14,410 p=46254 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:26:15,727 p=46254 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:26:15,742 p=46254 u=marwiesing n=ansible | TASK [Clean up args, probes, and ports in DaemonSet] *********************************************************************************************************************************************************************************************************
2025-03-28 14:26:16,148 p=46254 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--web.listen-address=:19100"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.052807'
  end: '2025-03-28 14:26:16.270645'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:26:16.217838'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 14:26:16,148 p=46254 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:26:16,148 p=46254 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 14:26:48,822 p=46421 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:26:48,830 p=46421 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:26:50,112 p=46421 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:26:50,138 p=46421 u=marwiesing n=ansible | TASK [Clean up args, probes, and ports in DaemonSet] *********************************************************************************************************************************************************************************************************
2025-03-28 14:26:50,634 p=46421 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.072632'
  end: '2025-03-28 14:26:50.748786'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:26:50.676154'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 14:26:50,635 p=46421 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:26:50,636 p=46421 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 14:28:23,086 p=46794 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:28:23,093 p=46794 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:28:24,382 p=46794 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:28:24,398 p=46794 u=marwiesing n=ansible | TASK [Patch DaemonSet for args, probes, ports, and fix duplicate port] ***************************************************************************************************************************************************************************************
2025-03-28 14:28:24,836 p=46794 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      { "op": "remove", "path": "/spec/template/spec/containers/0/args/4" },
      { "op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--web.listen-address=:19100" },
      { "op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100 },
      { "op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100 },
      { "op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100 },
      { "op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100" },
      { "op": "remove", "path": "/spec/template/spec/containers/0/ports/1" }
    ]
  delta: '0:00:00.065733'
  end: '2025-03-28 14:28:24.956777'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:28:24.891044'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 14:28:24,838 p=46794 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:28:24,838 p=46794 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 14:31:11,138 p=47432 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:31:11,147 p=47432 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:31:12,436 p=47432 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:31:12,452 p=47432 u=marwiesing n=ansible | TASK [Patch DaemonSet for args, probes, ports, and fix duplicate port] ***************************************************************************************************************************************************************************************
2025-03-28 14:31:12,921 p=47432 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--web.listen-address=:19100"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.058212'
  end: '2025-03-28 14:31:13.045990'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:31:12.987778'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 14:31:12,922 p=47432 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:31:12,922 p=47432 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 14:32:31,191 p=47762 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 14:32:31,200 p=47762 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:32,550 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:32,566 p=47762 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:32,999 p=47762 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:32:33,007 p=47762 u=marwiesing n=ansible | TASK [Patch DaemonSet with tolerations] **********************************************************************************************************************************************************************************************************************
2025-03-28 14:32:33,418 p=47762 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:32:33,430 p=47762 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:33,952 p=47762 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:32:33,964 p=47762 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:34,340 p=47762 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 14:32:34,351 p=47762 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:34,779 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:34,792 p=47762 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:34,845 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:34,861 p=47762 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 14:32:35,294 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:35,309 p=47762 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 14:32:35,325 p=47762 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 14:32:35,343 p=47762 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:35,367 p=47762 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 14:32:35,386 p=47762 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 14:32:35,860 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:35,870 p=47762 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 14:32:36,194 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:36,224 p=47762 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 14:32:36,624 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:32:36,634 p=47762 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 14:33:36,977 p=47762 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.044204'
  end: '2025-03-28 14:33:37.098148'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 14:32:37.053944'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-qgbqv
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-rdnv7
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
    pod/prometheus-prometheus-node-exporter-m5qwf condition met
  stdout_lines: <omitted>
2025-03-28 14:33:36,977 p=47762 u=marwiesing n=ansible | ...ignoring
2025-03-28 14:33:36,983 p=47762 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 14:33:37,315 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:33:37,325 p=47762 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 14:33:37,655 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 14:33:37,663 p=47762 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 14:33:37,679 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (3h31m ago)   3h52m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (3h31m ago)   3h52m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (3h31m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (3h26m ago)   2d4h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0               3h10m   10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (3h31m ago)   3h54m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (3h31m ago)   3h54m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (3h31m ago)   3h52m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0               175m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-qgbqv                0/1     CrashLoopBackOff   3 (8s ago)      63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0               175m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 14:33:37,685 p=47762 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 14:33:37,702 p=47762 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (3h31m ago)   3h52m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (3h31m ago)   3h52m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (3h31m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (3h26m ago)   2d4h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0               3h10m   10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (3h31m ago)   3h54m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (3h31m ago)   3h54m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (3h31m ago)   3h52m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0               175m    192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-qgbqv                0/1     CrashLoopBackOff   3 (8s ago)      63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0               175m    192.168.0.242   debian-1   <none>           <none>
2025-03-28 14:33:37,724 p=47762 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 14:33:37,725 p=47762 u=marwiesing n=ansible | ubuntu-1                   : ok=16   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-03-28 18:03:38,409 p=92471 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:03:38,417 p=92471 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:03:39,712 p=92471 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:03:39,767 p=92471 u=marwiesing n=ansible | TASK [Patch DaemonSet for args, probes, ports, and fix duplicate port] ***************************************************************************************************************************************************************************************
2025-03-28 18:03:40,295 p=92471 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--web.listen-address=:19100"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.068856'
  end: '2025-03-28 18:03:40.471364'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:03:40.402508'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:03:40,296 p=92471 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:03:40,296 p=92471 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:05:31,189 p=92899 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:05:31,197 p=92899 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:05:33,413 p=92899 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:05:33,435 p=92899 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:05:33,862 p=92899 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"},
      {"op": "add", "path": ".../args/-", "value": "--web.listen-address=:19100"}
    ]
  delta: '0:00:00.056595'
  end: '2025-03-28 18:05:34.043928'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:05:33.987333'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:05:33,863 p=92899 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:05:33,863 p=92899 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:05:49,928 p=92999 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:05:49,936 p=92999 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:05:52,164 p=92999 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:05:52,180 p=92999 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:05:52,651 p=92999 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.062379'
  end: '2025-03-28 18:05:52.827741'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:05:52.765362'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:05:52,652 p=92999 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:05:52,652 p=92999 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:06:02,549 p=93075 u=marwiesing n=ansible | Using /home/marwiesing/playground/ansible/00_Repair_Playbooks/ansible.cfg as config file
2025-03-28 18:06:06,001 p=93075 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:06:06,008 p=93075 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:06:07,277 p=93075 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:06:07,292 p=93075 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:06:07,802 p=93075 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.071652'
  end: '2025-03-28 18:06:07.968930'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:06:07.897278'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:06:07,803 p=93075 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:06:07,803 p=93075 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:08:01,476 p=93529 u=marwiesing n=ansible | Using /home/marwiesing/playground/ansible/00_Repair_Playbooks/ansible.cfg as config file
2025-03-28 18:08:04,498 p=93529 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:08:04,506 p=93529 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:05,861 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:08:05,877 p=93529 u=marwiesing n=ansible | TASK [Clean up args, probes, and ports in DaemonSet] *********************************************************************************************************************************************************************************************************
2025-03-28 18:08:06,327 p=93529 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.059225'
  end: '2025-03-28 18:08:06.505969'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:08:06.446744'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:08:06,327 p=93529 u=marwiesing n=ansible | ...ignoring
2025-03-28 18:08:06,337 p=93529 u=marwiesing n=ansible | TASK [Patch DaemonSet with tolerations] **********************************************************************************************************************************************************************************************************************
2025-03-28 18:08:06,717 p=93529 u=marwiesing n=ansible | changed: [ubuntu-1] => changed=true 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {
        "op": "add",
        "path": "/spec/template/spec/tolerations/-",
        "value": {
          "key": "node-role.kubernetes.io/control-plane",
          "operator": "Exists",
          "effect": "NoSchedule"
        }
      },
      {
        "op": "add",
        "path": "/spec/template/spec/tolerations/-",
        "value": {
          "key": "key",
          "value": "value",
          "operator": "Equal",
          "effect": "NoSchedule"
        }
      }
    ]
  delta: '0:00:00.064885'
  end: '2025-03-28 18:08:06.867183'
  msg: ''
  rc: 0
  start: '2025-03-28 18:08:06.802298'
  stderr: ''
  stderr_lines: <omitted>
  stdout: daemonset.apps/prometheus-prometheus-node-exporter patched
  stdout_lines: <omitted>
2025-03-28 18:08:06,728 p=93529 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:07,188 p=93529 u=marwiesing n=ansible | changed: [ubuntu-1] => changed=true 
  cmd:
  - kubectl
  - rollout
  - restart
  - daemonset
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  delta: '0:00:00.085716'
  end: '2025-03-28 18:08:07.353314'
  msg: ''
  rc: 0
  start: '2025-03-28 18:08:07.267598'
  stderr: ''
  stderr_lines: <omitted>
  stdout: daemonset.apps/prometheus-prometheus-node-exporter restarted
  stdout_lines: <omitted>
2025-03-28 18:08:07,200 p=93529 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:07,693 p=93529 u=marwiesing n=ansible | changed: [ubuntu-1] => changed=true 
  cmd:
  - kubectl
  - patch
  - service
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  - --type=json
  - |-
    -p=[
      {"op": "replace", "path": "/spec/ports/0/port", "value": 19100},
      {"op": "replace", "path": "/spec/ports/0/targetPort", "value": 19100}
    ]
  delta: '0:00:00.093543'
  end: '2025-03-28 18:08:07.861317'
  msg: ''
  rc: 0
  start: '2025-03-28 18:08:07.767774'
  stderr: ''
  stderr_lines: <omitted>
  stdout: service/prometheus-prometheus-node-exporter patched (no change)
  stdout_lines: <omitted>
2025-03-28 18:08:07,704 p=93529 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:08,054 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  cmd:
  - kubectl
  - get
  - pods
  - -n
  - monitoring
  delta: '0:00:00.057553'
  end: '2025-03-28 18:08:08.233627'
  msg: ''
  rc: 0
  start: '2025-03-28 18:08:08.176074'
  stderr: ''
  stderr_lines: <omitted>
  stdout: |-
    NAME                                                     READY   STATUS        RESTARTS       AGE
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running       2 (7h6m ago)   7h27m
    loki-0                                                   1/1     Running       1 (7h6m ago)   7h27m
    loki-promtail-lh44s                                      1/1     Running       5 (7h6m ago)   12d
    loki-promtail-qtk9h                                      1/1     Running       7 (7h1m ago)   2d8h
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running       0              6h45m
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running       1 (7h6m ago)   7h29m
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running       1 (7h6m ago)   7h29m
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running       2 (7h6m ago)   7h27m
    prometheus-prometheus-node-exporter-k82zn                0/1     Terminating   0              1s
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running       0              6h30m
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running       0              6h30m
  stdout_lines: <omitted>
2025-03-28 18:08:08,061 p=93529 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:08,101 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  ansible_facts:
    failed_pods: []
2025-03-28 18:08:08,109 p=93529 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 18:08:08,463 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  cmd: |-
    kubectl get pods -n monitoring --no-headers | grep loki-promtail | grep -E 'CrashLoopBackOff|Unknown' | awk '{print $1}'
  delta: '0:00:00.073340'
  end: '2025-03-28 18:08:08.636325'
  msg: ''
  rc: 0
  start: '2025-03-28 18:08:08.562985'
  stderr: ''
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:08:08,477 p=93529 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 18:08:08,491 p=93529 u=marwiesing n=ansible | skipping: [ubuntu-1] => changed=false 
  skipped_reason: No items in the list
2025-03-28 18:08:08,504 p=93529 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:08,531 p=93529 u=marwiesing n=ansible | skipping: [ubuntu-1] => changed=false 
  skipped_reason: No items in the list
2025-03-28 18:08:08,549 p=93529 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 18:08:08,993 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  gid: 0
  group: root
  mode: '0755'
  owner: root
  path: /run/promtail
  size: 60
  state: directory
  uid: 0
2025-03-28 18:08:09,001 p=93529 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 18:08:09,401 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  gid: 0
  group: root
  mode: '0755'
  owner: root
  path: /var/lib/docker/containers
  size: 4096
  state: directory
  uid: 0
2025-03-28 18:08:09,409 p=93529 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 18:08:09,802 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  gid: 0
  group: root
  mode: '0755'
  owner: root
  path: /var/log/pods
  size: 4096
  state: directory
  uid: 0
2025-03-28 18:08:09,808 p=93529 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 18:09:10,141 p=93529 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.051511'
  end: '2025-03-28 18:09:10.318787'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:08:10.267276'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-44cdl
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-m5qwf
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-rdnv7
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
  stdout_lines: <omitted>
2025-03-28 18:09:10,141 p=93529 u=marwiesing n=ansible | ...ignoring
2025-03-28 18:09:10,149 p=93529 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:09:10,478 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  cmd:
  - kubectl
  - get
  - endpoints
  - -n
  - monitoring
  - prometheus-prometheus-node-exporter
  delta: '0:00:00.058275'
  end: '2025-03-28 18:09:10.654469'
  msg: ''
  rc: 0
  start: '2025-03-28 18:09:10.596194'
  stderr: ''
  stderr_lines: <omitted>
  stdout: |-
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  stdout_lines: <omitted>
2025-03-28 18:09:10,486 p=93529 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 18:09:10,944 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => changed=false 
  cmd:
  - kubectl
  - get
  - pods
  - -n
  - monitoring
  - -o
  - wide
  delta: '0:00:00.083099'
  end: '2025-03-28 18:09:11.109146'
  msg: ''
  rc: 0
  start: '2025-03-28 18:09:11.026047'
  stderr: ''
  stderr_lines: <omitted>
  stdout: |-
    NAME                                                     READY   STATUS             RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (7h7m ago)   7h28m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (7h7m ago)   7h28m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (7h7m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (7h2m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0              6h46m   10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (7h7m ago)   7h30m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (7h7m ago)   7h30m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (7h7m ago)   7h28m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-44cdl                0/1     CrashLoopBackOff   3 (8s ago)     63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0              6h31m   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0              6h31m   192.168.0.242   debian-1   <none>           <none>
  stdout_lines: <omitted>
2025-03-28 18:09:10,953 p=93529 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 18:09:10,976 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (7h7m ago)   7h28m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (7h7m ago)   7h28m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (7h7m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (7h2m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0              6h46m   10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (7h7m ago)   7h30m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (7h7m ago)   7h30m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (7h7m ago)   7h28m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-44cdl                0/1     CrashLoopBackOff   3 (8s ago)     63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0              6h31m   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0              6h31m   192.168.0.242   debian-1   <none>           <none>
2025-03-28 18:09:10,989 p=93529 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 18:09:11,018 p=93529 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS       AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (7h7m ago)   7h28m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (7h7m ago)   7h28m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (7h7m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (7h2m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0              6h46m   10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (7h7m ago)   7h30m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (7h7m ago)   7h30m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (7h7m ago)   7h28m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-44cdl                0/1     CrashLoopBackOff   3 (8s ago)     63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0              6h31m   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0              6h31m   192.168.0.242   debian-1   <none>           <none>
2025-03-28 18:09:11,051 p=93529 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:09:11,052 p=93529 u=marwiesing n=ansible | ubuntu-1                   : ok=16   changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=2   
2025-03-28 18:13:52,843 p=94871 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:13:52,849 p=94871 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:13:54,310 p=94871 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:13:54,326 p=94871 u=marwiesing n=ansible | TASK [Remove invalid from DaemonSet args] ********************************************************************************************************************************************************************************************************************
2025-03-28 18:13:54,822 p=94871 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"}
    ]
  delta: '0:00:00.065303'
  end: '2025-03-28 18:13:54.995757'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:13:54.930454'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:13:54,824 p=94871 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:13:54,825 p=94871 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:16:10,200 p=95409 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:16:10,211 p=95409 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:16:11,510 p=95409 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:16:11,532 p=95409 u=marwiesing n=ansible | TASK [Clean up args, probes, and ports in DaemonSet] *********************************************************************************************************************************************************************************************************
2025-03-28 18:16:11,968 p=95409 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.057224'
  end: '2025-03-28 18:16:12.149064'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:16:12.091840'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:16:11,969 p=95409 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:16:11,969 p=95409 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:17:42,174 p=95764 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:17:42,181 p=95764 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:17:43,477 p=95764 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:17:43,500 p=95764 u=marwiesing n=ansible | TASK [Clean up args, probes, and ports in DaemonSet] *********************************************************************************************************************************************************************************************************
2025-03-28 18:17:43,950 p=95764 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"},
      {"op": "replace", "path": "/spec/template/spec/containers/0/livenessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/readinessProbe/httpGet/port", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/containerPort", "value": 19100},
      {"op": "replace", "path": "/spec/template/spec/containers/0/ports/0/name", "value": "metrics-19100"},
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.055651'
  end: '2025-03-28 18:17:44.131696'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:17:44.076045'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:17:43,950 p=95764 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:17:43,951 p=95764 u=marwiesing n=ansible | ubuntu-1                   : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:18:28,085 p=96024 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:18:28,093 p=96024 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:18:29,199 p=96024 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:18:29,215 p=96024 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:18:29,656 p=96024 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:18:29,664 p=96024 u=marwiesing n=ansible | TASK [Remove duplicate port definition from DaemonSet] *******************************************************************************************************************************************************************************************************
2025-03-28 18:18:29,996 p=96024 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/ports/1"}
    ]
  delta: '0:00:00.060823'
  end: '2025-03-28 18:18:30.170891'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:18:30.110068'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:18:29,997 p=96024 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:18:29,998 p=96024 u=marwiesing n=ansible | ubuntu-1                   : ok=2    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:20:43,898 p=96543 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:20:43,904 p=96543 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:20:45,175 p=96543 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:20:45,192 p=96543 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:20:45,683 p=96543 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:20:45,689 p=96543 u=marwiesing n=ansible | TASK [Remove invalid from DaemonSet args] ********************************************************************************************************************************************************************************************************************
2025-03-28 18:20:46,037 p=96543 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - patch
  - daemonset
  - prometheus-prometheus-node-exporter
  - -n
  - monitoring
  - --type=json
  - |-
    -p=[
      {"op": "remove", "path": "/spec/template/spec/containers/0/args/4"}
    ]
  delta: '0:00:00.072702'
  end: '2025-03-28 18:20:46.212667'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:20:46.139965'
  stderr: 'The request is invalid: the server rejected our request due to an error in our request'
  stderr_lines: <omitted>
  stdout: ''
  stdout_lines: <omitted>
2025-03-28 18:20:46,038 p=96543 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:20:46,038 p=96543 u=marwiesing n=ansible | ubuntu-1                   : ok=2    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-03-28 18:23:56,196 p=97263 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:23:56,202 p=97263 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:23:57,499 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:23:57,514 p=97263 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:23:57,968 p=97263 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:23:57,975 p=97263 u=marwiesing n=ansible | TASK [Check number of ports in DaemonSet container] **********************************************************************************************************************************************************************************************************
2025-03-28 18:23:58,293 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:23:58,301 p=97263 u=marwiesing n=ansible | TASK [Remove duplicate port definition from DaemonSet if it exists] ******************************************************************************************************************************************************************************************
2025-03-28 18:23:58,330 p=97263 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:23:58,343 p=97263 u=marwiesing n=ansible | TASK [Check number of args in DaemonSet container] ***********************************************************************************************************************************************************************************************************
2025-03-28 18:23:58,756 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:23:58,764 p=97263 u=marwiesing n=ansible | TASK [Remove invalid arg from DaemonSet if it exists] ********************************************************************************************************************************************************************************************************
2025-03-28 18:23:58,800 p=97263 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:23:58,811 p=97263 u=marwiesing n=ansible | TASK [Patch DaemonSet with tolerations] **********************************************************************************************************************************************************************************************************************
2025-03-28 18:23:59,148 p=97263 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:23:59,158 p=97263 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 18:23:59,601 p=97263 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:23:59,612 p=97263 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 18:24:00,050 p=97263 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:24:00,065 p=97263 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 18:24:00,501 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:24:00,512 p=97263 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 18:24:00,561 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:24:00,572 p=97263 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 18:24:00,960 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:24:00,969 p=97263 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 18:24:00,981 p=97263 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:24:00,987 p=97263 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 18:24:00,997 p=97263 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:24:01,007 p=97263 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 18:24:01,495 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:24:01,504 p=97263 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 18:24:01,854 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:24:01,863 p=97263 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 18:24:02,155 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:24:02,161 p=97263 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 18:25:02,535 p=97263 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.045224'
  end: '2025-03-28 18:25:02.708593'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:24:02.663369'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-g8x2z
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-m5qwf
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-rdnv7
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
  stdout_lines: <omitted>
2025-03-28 18:25:02,535 p=97263 u=marwiesing n=ansible | ...ignoring
2025-03-28 18:25:02,545 p=97263 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:25:02,916 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:25:02,928 p=97263 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 18:25:03,304 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:25:03,311 p=97263 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 18:25:03,330 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS             RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (7h23m ago)   7h43m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (7h23m ago)   7h43m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (7h23m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (7h17m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0               7h1m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (7h23m ago)   7h46m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (7h23m ago)   7h46m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (7h23m ago)   7h43m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-g8x2z                0/1     CrashLoopBackOff   3 (8s ago)      63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0               6h47m   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0               6h47m   192.168.0.242   debian-1   <none>           <none>
2025-03-28 18:25:03,337 p=97263 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 18:25:03,354 p=97263 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                 AGE
    prometheus-prometheus-node-exporter   192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS             RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running            2 (7h23m ago)   7h43m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running            1 (7h23m ago)   7h43m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running            5 (7h23m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running            7 (7h17m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running            0               7h1m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running            1 (7h23m ago)   7h46m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running            1 (7h23m ago)   7h46m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running            2 (7h23m ago)   7h43m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-g8x2z                0/1     CrashLoopBackOff   3 (8s ago)      63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-m5qwf                1/1     Running            0               6h47m   192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-rdnv7                1/1     Running            0               6h47m   192.168.0.242   debian-1   <none>           <none>
2025-03-28 18:25:03,372 p=97263 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:25:03,373 p=97263 u=marwiesing n=ansible | ubuntu-1                   : ok=18   changed=4    unreachable=0    failed=0    skipped=4    rescued=0    ignored=1   
2025-03-28 18:28:39,621 p=98406 u=marwiesing n=ansible | PLAY [Patch Kubernetes DaemonSet and Service] ****************************************************************************************************************************************************************************************************************
2025-03-28 18:28:39,629 p=98406 u=marwiesing n=ansible | TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:40,942 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:40,957 p=98406 u=marwiesing n=ansible | TASK [Patch DaemonSet] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:41,392 p=98406 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:28:41,398 p=98406 u=marwiesing n=ansible | TASK [Check number of ports in DaemonSet container] **********************************************************************************************************************************************************************************************************
2025-03-28 18:28:41,773 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:41,781 p=98406 u=marwiesing n=ansible | TASK [Remove duplicate port definition from DaemonSet if it exists] ******************************************************************************************************************************************************************************************
2025-03-28 18:28:41,816 p=98406 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:28:41,826 p=98406 u=marwiesing n=ansible | TASK [Check number of args in DaemonSet container] ***********************************************************************************************************************************************************************************************************
2025-03-28 18:28:42,155 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:42,164 p=98406 u=marwiesing n=ansible | TASK [Remove invalid arg from DaemonSet if it exists] ********************************************************************************************************************************************************************************************************
2025-03-28 18:28:42,218 p=98406 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:28:42,228 p=98406 u=marwiesing n=ansible | TASK [Add valid --web.listen-address=:19100 if not present] **************************************************************************************************************************************************************************************************
2025-03-28 18:28:42,619 p=98406 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:28:42,630 p=98406 u=marwiesing n=ansible | TASK [Patch DaemonSet with tolerations] **********************************************************************************************************************************************************************************************************************
2025-03-28 18:28:43,110 p=98406 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:28:43,120 p=98406 u=marwiesing n=ansible | TASK [Restart DaemonSet Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:43,532 p=98406 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:28:43,541 p=98406 u=marwiesing n=ansible | TASK [Patch Service] *****************************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:43,887 p=98406 u=marwiesing n=ansible | changed: [ubuntu-1]
2025-03-28 18:28:43,898 p=98406 u=marwiesing n=ansible | TASK [Wait for Pods to stabilize] ****************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:44,288 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:44,300 p=98406 u=marwiesing n=ansible | TASK [Identify CrashLoopBackOff Pods] ************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:44,338 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:44,349 p=98406 u=marwiesing n=ansible | TASK [Identify Loki Promtail pods in CrashLoopBackOff or Unknown] ********************************************************************************************************************************************************************************************
2025-03-28 18:28:44,786 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:44,793 p=98406 u=marwiesing n=ansible | TASK [Force delete crashed Loki Promtail pods] ***************************************************************************************************************************************************************************************************************
2025-03-28 18:28:44,804 p=98406 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:28:44,816 p=98406 u=marwiesing n=ansible | TASK [Delete failed Pods] ************************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:44,842 p=98406 u=marwiesing n=ansible | skipping: [ubuntu-1]
2025-03-28 18:28:44,860 p=98406 u=marwiesing n=ansible | TASK [Ensure /run/promtail exists with correct permissions] **************************************************************************************************************************************************************************************************
2025-03-28 18:28:45,345 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:45,355 p=98406 u=marwiesing n=ansible | TASK [Ensure /var/lib/docker/containers exists] **************************************************************************************************************************************************************************************************************
2025-03-28 18:28:45,646 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:45,654 p=98406 u=marwiesing n=ansible | TASK [Ensure /var/log/pods exists] ***************************************************************************************************************************************************************************************************************************
2025-03-28 18:28:46,087 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:28:46,099 p=98406 u=marwiesing n=ansible | TASK [Wait for Pods to be ready] *****************************************************************************************************************************************************************************************************************************
2025-03-28 18:29:46,458 p=98406 u=marwiesing n=ansible | fatal: [ubuntu-1]: FAILED! => changed=false 
  cmd:
  - kubectl
  - wait
  - --for=condition=Ready
  - pod
  - --all
  - -n
  - monitoring
  - --timeout=60s
  delta: '0:01:00.048579'
  end: '2025-03-28 18:29:46.623821'
  msg: non-zero return code
  rc: 1
  start: '2025-03-28 18:28:46.575242'
  stderr: |-
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-m5qwf
    timed out waiting for the condition on pods/prometheus-prometheus-node-exporter-p9r99
  stderr_lines: <omitted>
  stdout: |-
    pod/alertmanager-prometheus-kube-prometheus-alertmanager-0 condition met
    pod/loki-0 condition met
    pod/loki-promtail-lh44s condition met
    pod/loki-promtail-qtk9h condition met
    pod/prometheus-grafana-6c59f78f66-r7nm2 condition met
    pod/prometheus-kube-prometheus-operator-58dbc8bb4f-79s46 condition met
    pod/prometheus-kube-state-metrics-5bc7f89f46-kdw7r condition met
    pod/prometheus-prometheus-kube-prometheus-prometheus-0 condition met
    pod/prometheus-prometheus-node-exporter-hj9r6 condition met
  stdout_lines: <omitted>
2025-03-28 18:29:46,458 p=98406 u=marwiesing n=ansible | ...ignoring
2025-03-28 18:29:46,466 p=98406 u=marwiesing n=ansible | TASK [Check Endpoints] ***************************************************************************************************************************************************************************************************************************************
2025-03-28 18:29:46,783 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:29:46,789 p=98406 u=marwiesing n=ansible | TASK [Get final list of Pods] ********************************************************************************************************************************************************************************************************************************
2025-03-28 18:29:47,128 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1]
2025-03-28 18:29:47,134 p=98406 u=marwiesing n=ansible | TASK [Display final results] *********************************************************************************************************************************************************************************************************************************
2025-03-28 18:29:47,152 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg:
  - |-
    Endpoints:
    NAME                                  ENDPOINTS                                                     AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100   9d
  - |-
    Pods:
    NAME                                                     READY   STATUS    RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (7h27m ago)   7h48m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (7h27m ago)   7h48m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (7h27m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (7h22m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0               7h6m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (7h27m ago)   7h51m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (7h27m ago)   7h51m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (7h27m ago)   7h48m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-68d2c                1/1     Running   0               60s     192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-hj9r6                1/1     Running   0               63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-p9r99                1/1     Running   0               62s     192.168.0.242   debian-1   <none>           <none>
2025-03-28 18:29:47,163 p=98406 u=marwiesing n=ansible | TASK [Final report summary] **********************************************************************************************************************************************************************************************************************************
2025-03-28 18:29:47,192 p=98406 u=marwiesing n=ansible | ok: [ubuntu-1] => 
  msg: |-
     Prometheus Node Exporter and Service patched successfully.
     DaemonSet restarted.
     Any failing pods (e.g. Grafana) were deleted and recreated.
     Endpoints now serve on port 19100:
      NAME                                  ENDPOINTS                                                     AGE
    prometheus-prometheus-node-exporter   192.168.0.100:19100,192.168.0.240:19100,192.168.0.242:19100   9d
     Current Pod overview:
      NAME                                                     READY   STATUS    RESTARTS        AGE     IP              NODE       NOMINATED NODE   READINESS GATES
    alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (7h27m ago)   7h48m   10.32.0.4       debian-1   <none>           <none>
    loki-0                                                   1/1     Running   1 (7h27m ago)   7h48m   10.32.0.12      debian-1   <none>           <none>
    loki-promtail-lh44s                                      1/1     Running   5 (7h27m ago)   12d     10.32.0.20      debian-1   <none>           <none>
    loki-promtail-qtk9h                                      1/1     Running   7 (7h22m ago)   2d8h    10.44.0.3       ubuntu     <none>           <none>
    prometheus-grafana-6c59f78f66-r7nm2                      3/3     Running   0               7h6m    10.32.0.8       debian-1   <none>           <none>
    prometheus-kube-prometheus-operator-58dbc8bb4f-79s46     1/1     Running   1 (7h27m ago)   7h51m   10.32.0.15      debian-1   <none>           <none>
    prometheus-kube-state-metrics-5bc7f89f46-kdw7r           1/1     Running   1 (7h27m ago)   7h51m   10.32.0.14      debian-1   <none>           <none>
    prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   2 (7h27m ago)   7h48m   10.32.0.7       debian-1   <none>           <none>
    prometheus-prometheus-node-exporter-68d2c                1/1     Running   0               60s     192.168.0.240   ubuntu-2   <none>           <none>
    prometheus-prometheus-node-exporter-hj9r6                1/1     Running   0               63s     192.168.0.100   ubuntu     <none>           <none>
    prometheus-prometheus-node-exporter-p9r99                1/1     Running   0               62s     192.168.0.242   debian-1   <none>           <none>
2025-03-28 18:29:47,220 p=98406 u=marwiesing n=ansible | PLAY RECAP ***************************************************************************************************************************************************************************************************************************************************
2025-03-28 18:29:47,221 p=98406 u=marwiesing n=ansible | ubuntu-1                   : ok=19   changed=5    unreachable=0    failed=0    skipped=4    rescued=0    ignored=1   
